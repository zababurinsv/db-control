var _CSRF, _CSRFToken, _currentUser_id, _load_rider = !1, _rider_name = "", _rider_title = "", _band_name = "", _band_logo = "", _phone = "", _email = "", _contact_name = "";
b4w.register("my_project_main", function(fc, C) {
    function gc(a, b) {
        if (b) {
            nb.create_preloader();
            a.addEventListener("mousedown", za);
            a.addEventListener("touchstart", za);
            a.addEventListener("mouseup", ka);
            a.addEventListener("touchend", ka);
            a.addEventListener("mousemove", la);
            a.addEventListener("touchmove", la);
            window.onresize = Sa.resize_to_container;
            Sa.resize_to_container();
            try {
                var c = new XMLHttpRequest;
                c.open("GET", "./nr.json", !1);
                c.send(null);
                var d = JSON.parse(c.responseText);
                1 == d.enable ? Aa.load(Ta + d.model_src, ob, pb) : Aa.load(Ta + "my_project3.json", ob, pb)
            } catch (e) {
                console.log("\u041e\u0428\u0418\u0411\u041a\u0410 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 load"),
                    console.log(e)
            }
        } else
            console.log("b4w init failure")
    }
    function pb(a) {
        nb.update_preloader(a)
    }
    function ob(a, b) {
        try {
            ma.enable_camera_controls(!1, !0, !1, Sa.get_canvas());
            hc();
            var c = p.get_object_by_name("spawner");
            y.get_translation(c, Ua);
            c = "../stage.json";
            _load_rider && (c = "../rider.php?id=" + _load_rider);
            qb(c);
            na ? (rb(),
                oa("show_grid_button")) : sb();
            T && oa("show_anchors_button");
            var d = p.get_object_by_name("TargetPlane");
            p.hide_object(d)
        } catch (e) {
            console.log("\u041e\u0428\u0418\u0411\u041a\u0410 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 init_controls"),
                console.log(e)
        }
    }
    function hc() {
        try {
            var a = document.getElementById("controls-container")
                , b = function(a) {
                a = document.getElementById("properties-form-container");
                A(a)
            };
            E(a, "properties_button", "Properties of object", "obj_properties.png", b, !1);
            b = function(a) {
                tb(1)
            }
            ;
            E(a, "rot-ccw", "Rotate left", "turn-left.png", b, !1);
            b = function(a) {
                tb(-1)
            }
            ;
            E(a, "rot-cw", "Rotate right", "turn-right.png", b, !1);
            _currentUser_id && 1 == _currentUser_id && (b = function(a) {
                a = document.getElementById("addobject-form-container");
                A(a)
            }
                ,
                E(a, "addobject_button", "Upload 3d object", "add_preset.png", b, !1),
                document.getElementById("tr_useborder").classList.remove("hidden"));
            b = function(a) {
                if (t)
                    try {
                        var b = p.get_object_data_id(t);
                        ub(b)
                    } catch (u) {
                        console.log("\u041e\u0428\u0418\u0411\u041a\u0410 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 delete_object"),
                            console.log(u)
                    }
            }
            ;
            E(a, "delete", "Delete selected object", "delete.png", b, !1);
            b = function(a) {
                t ? (Va(),
                    Wa = !0,
                    Ha = t,
                    oa("attach")) : alert("Please, select object for link first")
            }
            ;
            E(a, "attach", "Attach object to another", "link.png", b, !0);
            b = function(a) {
                t ? (a = document.getElementById("savepreset-form-container"),
                    A(a)) : alert("Please, select main object to save preset")
            }
            ;
            E(a, "preset_save_button", "Save preset", "save-preset.png", b, !1);
            b = function(a) {
                if (t)
                    try {
                        p.get_object_data_id(t);
                        for (var b = f.length - 1; 0 <= b; b--)
                            if (f[b].selected) {
                                console.log("DELETING id:" + f[b].id + " index:" + b);
                                Aa.unload(f[b].id);
                                var c = document.getElementById("anchor" + f[b].id);
                                c.parentNode.removeChild(c);
                                f[b].obj = null;
                                for (a = 0; a < f[b].input_list.length; a++)
                                    delete f[b].input_list[a].obj;
                                for (a = 0; a < f[b].output_list.length; a++)
                                    delete f[b].output_list[a].obj;
                                for (a = 0; a < f[b].gear_list.length; a++)
                                    delete f[b].gear_list[a].obj;
                                f.splice(b, 1)
                            }
                        Ia();
                        X();
                        t = null;
                        L();
                        U();
                        ea();
                        console.log(f)
                    } catch (Ba) {
                        console.log("\u041e\u0428\u0418\u0411\u041a\u0410 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 delete_object_ierarhy"),
                            console.log(Ba)
                    }
            }
            ;
            E(a, "deletechild", "Delete object will all children", "delete-ierarhy.png", b, !1);
            vb(a);
            E(a, "show_anchors_button", "Show/hide annotations", "showannot.png", ic, !0);
            b = function(a) {
                (a = prompt("Please, Name of rider", _rider_name)) && wb(a)
            }
            ;
            E(a, "rider_save_button", "Save Rider to database", "save-rider.png", b, !1);
            b = function(a) {
                a = document.getElementById("restore-form-container");
                A(a)
            }
            ;
            E(a, "rider_restore_button", "Restore rider", "restore-stage.png", b, !1);
            E(a, "show_grid_button", "Show/hide coordinate grid", "showgrid.png", jc, !0);
            vb(a);
            b = function(a) {
                a = document.getElementById("stage-form-container");
                A(a)
            }
            ;
            E(a, "stage_button", "Publish rider", "finish.png", b, !1);
            E(a, "print_button", "Print of rider", "print.png", kc, !1);
            b = function(a) {
                document.location = "/riders.php"
            }
            ;
            E(a, "exit_button", "Exit to My Riders", "exit_button.png", b, !1);
            document.getElementById("savepreset").addEventListener("click", lc);
            document.getElementById("addobject").addEventListener("click", mc);
            document.getElementById("restorerider").addEventListener("click", nc);
            document.getElementById("deleterider").addEventListener("click", oc);
            document.getElementById("saveprop").addEventListener("click", pc);
            document.getElementById("savestage").addEventListener("click", xb);
            document.getElementById("savelistrow").addEventListener("click", qc);
            document.getElementById("deletelistrow").addEventListener("click", rc);
            document.getElementById("savegearlistrow").addEventListener("click", sc);
            document.getElementById("deletegearlistrow").addEventListener("click", tc);
            document.getElementById("addinput").addEventListener("click", yb);
            document.getElementById("addoutput").addEventListener("click", zb);
            document.getElementById("addgear").addEventListener("click", Ab);
            document.getElementById("toggle_controls").addEventListener("click", function(a) {
                a = document.getElementById("controls-container");
                A(a)
            });
            document.getElementById("addstageinput").addEventListener("click", function(a) {
                za(a);
                ka(a);
                yb(a)
            });
            document.getElementById("addstageoutput").addEventListener("click", function(a) {
                za(a);
                ka(a);
                zb(a)
            });
            document.getElementById("addstagegear").addEventListener("click", function(a) {
                za(a);
                ka(a);
                Ab(a)
            });
            document.getElementById("input-list-header").addEventListener("click", function(a) {
                Ja("input")
            });
            document.getElementById("output-list-header").addEventListener("click", function(a) {
                Ja("output")
            });
            document.getElementById("gear-list-header").addEventListener("click", function(a) {
                Ja("gear")
            });
            b = function(a) {
                Ja("rider-text")
            }
            ;
            document.getElementById("rider-text-list-header").addEventListener("click", b);
            document.getElementById("openridertab").addEventListener("click", b);
            document.getElementById("publish").addEventListener("click", uc);
            Xa();
            Bb();
            Cb();
            vc();
            wc();
            var c = document.getElementById("button-container");
            c.addEventListener("touchmove", la);
            c.addEventListener("mousemove", la);
            for (var d = document.getElementById("tabs-container"), e = document.getElementById("tags-container"), a = 0; a < r.length; a++)
                if (0 < r[a].presets.length) {
                    var g = document.createElement("div");
                    g.className = "category_button";
                    g.id = "menu_category_" + r[a].name;
                    g.addEventListener("click", function(a) {
                        try {
                            var b, c;
                            if (this.classList.contains("category_active"))
                                d = document.getElementById("menu-container"),
                                    A(d),
                                    this.classList.remove("category_active"),
                                    Ka = -1;
                            else {
                                var d = document.getElementById("menu-container");
                                d.classList.contains("hidden") && d.classList.remove("hidden");
                                var e = document.getElementsByClassName("category_button");
                                a = "";
                                for (d = 0; d < e.length; d++)
                                    e[d].classList.contains("category_active") && (a = e[d].id.split("_")[2],
                                        e[d].classList.remove("category_active"));
                                this.classList.add("category_active");
                                for (var f = this.id.split("_")[2], g = e = -1, d = 0; d < r.length; d++)
                                    r[d].name == f && (Ka = e = d),
                                    r[d].name == a && (g = d);
                                if (0 <= g) {
                                    for (d = 0; d < B.length; d++)
                                        b = document.getElementById("preset_button_" + B[d].id),
                                        b.classList.contains("hidden") || b.classList.add("hidden");
                                    for (d = 1; d < G.length; d++)
                                        c = document.getElementById("preset_tag_" + G[d].name),
                                        c.classList.contains("hidden") || c.classList.add("hidden")
                                }
                                if (0 <= e) {
                                    for (d = 0; d < r[e].presets.length; d++)
                                        b = document.getElementById("preset_button_" + r[e].presets[d].id),
                                        b.classList.contains("hidden") && b.classList.remove("hidden");
                                    r[e].selected_tags = [G[0]];
                                    for (d = 0; d < r[e].tags.length; d++)
                                        c = document.getElementById("preset_tag_" + r[e].tags[d]),
                                        c.classList.contains("hidden") && c.classList.remove("hidden"),
                                        c.classList.contains("active") && c.classList.remove("active");
                                    c = document.getElementById("preset_tag_all");
                                    c.classList.contains("active") || c.classList.add("active")
                                }
                                console.log(r[e])
                            }
                        } catch (xc) {
                            console.log("\u041e\u0428\u0418\u0411\u041a\u0410 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 menu_category_click"),
                                console.log(xc)
                        }
                    });
                    g.innerHTML = "" + r[a].name;
                    d.appendChild(g)
                }
            for (d = 0; d < B.length; d++) {
                var h = B[d]
                    , k = document.createElement("div");
                k.className = "button data-button hidden";
                k.title = h.name;
                c.appendChild(k);
                k.id = "preset_button_" + h.id;
                k.data = h.id;
                k.addEventListener("mouseup", function(a) {
                    console.log("but mouseup");
                    M ? alert("Please, wait, previous load still did not finish") : P && this.data == Y && (pa(),
                        Z(null),
                        P = !1,
                        a = p.get_object_by_name("TargetPlane"),
                        p.hide_object(a),
                        a = document.getElementById("waiticon"),
                        a.innerHTML = "",
                        a.style.left = window.innerWidth / 2 - a.offsetWidth / 2 + "px",
                        a.style.top = window.innerHeight / 2 - a.offsetHeight / 2 + "px",
                        console.log(window.innerWidth),
                        console.log("Load preset:" + this.data),
                        qa = ra = 0,
                        Ya(this.data),
                        this.classList.remove("pushed"))
                });
                k.addEventListener("mousedown", function(a) {
                    console.log("but mousedown");
                    if (M)
                        alert("Please, wait, previous load still did not finish");
                    else {
                        Va();
                        Y = this.data;
                        Ca = this.firstChild.src;
                        var b = document.getElementById("waiticon");
                        b.innerHTML = "<img src='" + Ca + "' width='75px' height='75px'/>";
                        b.style.left = "" + H.get_coords_x(a) + "px";
                        b.style.top = "" + H.get_coords_y(a) + "px";
                        b.classList.contains("run") && b.classList.remove("run");
                        Db(a);
                        b.classList.remove("hidden");
                        b.addEventListener("mouseup", ka);
                        this.classList.add("pushed")
                    }
                });
                k.addEventListener("touchstart", function(a) {
                    console.log("but touchstart");
                    if (M)
                        alert("Please, wait, previous load still did not finish");
                    else {
                        Va();
                        Y = this.data;
                        Ca = this.firstChild.src;
                        var b = document.getElementById("waiticon");
                        b.innerHTML = "<img src='" + Ca + "' width='75px' height='75px'/>";
                        b.style.left = "" + H.get_coords_x(a) + "px";
                        b.style.top = "" + H.get_coords_y(a) + "px";
                        b.classList.contains("run") && b.classList.remove("run");
                        Db(a);
                        b.classList.remove("hidden");
                        this.classList.add("pushed")
                    }
                });
                k.addEventListener("touchend", function(a) {
                    console.log("but touchend");
                    M ? alert("Please, wait, previous load still did not finish") : P && this.data == Y && (pa(),
                        Z(null),
                        P = !1,
                        a = p.get_object_by_name("TargetPlane"),
                        p.hide_object(a),
                        document.getElementById("waiticon").innerHTML = "",
                        console.log("Load preset:" + this.data),
                        Ya(this.data),
                        this.classList.remove("pushed"))
                });
                k.addEventListener("touchmove", la);
                k.addEventListener("mousemove", la);
                var m = document.createElement("img");
                m.src = h.image;
                m.alt = h.name;
                k.appendChild(m)
            }
            for (a = 0; a < G.length; a++)
                g = document.createElement("span"),
                    g.className = "all" == G[a].name ? "hidden active" : "hidden",
                    g.id = "preset_tag_" + G[a].name,
                    g.classList.add("preset_tag_" + G[a]["class"]),
                    g.addEventListener("click", function(a) {
                        try {
                            var b = this.id.split("_")[2], c;
                            if (!(0 > Ka)) {
                                var d = r[Ka], e;
                                for (a = 0; a < G.length; a++)
                                    if (G[a].name == b) {
                                        e = G[a];
                                        break
                                    }
                                if ("all" == b) {
                                    if ("all" != d.selected_tags[0].name) {
                                        for (a = 0; a < d.presets.length; a++)
                                            button = document.getElementById("preset_button_" + d.presets[a].id),
                                            button.classList.contains("hidden") && button.classList.remove("hidden");
                                        d.selected_tags = [e];
                                        for (a = 0; a < d.tags.length; a++)
                                            c = document.getElementById("preset_tag_" + d.tags[a]),
                                            c.classList.contains("active") && c.classList.remove("active");
                                        c = document.getElementById("preset_tag_all");
                                        c.classList.contains("active") || c.classList.add("active")
                                    }
                                } else if ("all" == d.selected_tags[0].name)
                                    for (d.selected_tags = [],
                                             c = document.getElementById("preset_tag_all"),
                                         c.classList.contains("active") && c.classList.remove("active"),
                                             d.selected_tags = [e],
                                             this.classList.add("active"),
                                             a = 0; a < d.presets.length; a++)
                                        button = document.getElementById("preset_button_" + d.presets[a].id),
                                            d.presets[a].tags.split(",").includes(b) ? button.classList.contains("hidden") && button.classList.remove("hidden") : button.classList.contains("hidden") || button.classList.add("hidden");
                                else {
                                    if (this.classList.contains("active")) {
                                        var f = d.selected_tags.indexOf(e);
                                        0 <= f && d.selected_tags.splice(f, 1);
                                        this.classList.remove("active");
                                        0 == d.selected_tags.length && (d.selected_tags = [G[0]],
                                            c = document.getElementById("preset_tag_all"),
                                        c.classList.contains("active") || c.classList.add("active"))
                                    } else
                                        d.selected_tags.push(e),
                                            this.classList.add("active");
                                    for (a = 0; a < d.presets.length; a++) {
                                        button = document.getElementById("preset_button_" + d.presets[a].id);
                                        e = c = b = void 0;
                                        for (var g = d.presets[a].tags, h = d.selected_tags, l = [[h[0]]], f = 0; f < h.length; f++) {
                                            e = !1;
                                            for (var k = 0; k < l.length; k++)
                                                l[k][0]["class"] == h[f]["class"] && (e = !0,
                                                    l[k].push(h[f]));
                                            e || l.push([h[f]])
                                        }
                                        c = !0;
                                        for (k = 0; k < l.length; k++) {
                                            b = !1;
                                            for (f = 0; f < l[k].length; f++)
                                                b = b || g.split(",").includes(l[k][f].name);
                                            c = c && b
                                        }
                                        c ? button.classList.contains("hidden") && button.classList.remove("hidden") : button.classList.contains("hidden") || button.classList.add("hidden")
                                    }
                                }
                            }
                        } catch (zc) {
                            console.log("\u041e\u0428\u0418\u0411\u041a\u0410 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 menu_tag_click"),
                                console.log(zc)
                        }
                    }),
                    g.innerHTML = "" + G[a].name,
                    e.appendChild(g);
            document.getElementById("addobject_form").elements.namedItem("object").addEventListener("change", Ac);
            document.getElementById("savepreset_form").elements.namedItem("id").addEventListener("change", Bc);
            document.getElementById("publish_form").elements.namedItem("Title").addEventListener("change", Da);
            document.getElementById("publish_form").elements.namedItem("Contact").addEventListener("change", Da);
            document.getElementById("publish_form").elements.namedItem("Phone").addEventListener("change", Da);
            document.getElementById("publish_form").elements.namedItem("email").addEventListener("change", Da);
            for (var l = document.getElementsByClassName("close-button"), d = 0; d < l.length; d++)
                l[d].addEventListener("click", function(a) {
                    A(this.parentNode)
                });
            window.onunload = function() {
                return confirm("Are you sure want to leave? Rider has not been saved")
            }
            ;
            window.onbeforeunload = function() {
                return confirm("Are you sure want to leave? Rider has not been saved")
            }
            ;
            document.onkeydown = function(a) {
                a = a || window.event;
                ("key"in a ? "Escape" === a.key || "Esc" === a.key : 27 === a.keyCode) && Eb && Fb()
            }
        } catch (q) {
            console.log("\u041e\u0428\u0418\u0411\u041a\u0410 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 init_controls"),
                console.log(q)
        }
    }
    function Ac(a) {
        try {
            var b = document.getElementById("addobject_form").elements.namedItem("object")
                , c = b.options[b.selectedIndex].text;
            a = [];
            a[0] = document.getElementById("jsonfile");
            a[1] = document.getElementById("binfile");
            a[2] = document.getElementById("imagefile");
            if ("Upload New Object" == c)
                for (var d = 0; 3 > d; d++)
                    a[d].classList.contains("hidden") && a[d].classList.remove("hidden");
            else
                for (d = 0; 3 > d; d++)
                    a[d].classList.contains("hidden") || a[d].classList.add("hidden")
        } catch (e) {
            console.log("\u041e\u0428\u0418\u0411\u041a\u0410 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 addobject_form_object_change"),
                console.log(e)
        }
    }
    function Bc(a) {
        try {
            var b = document.getElementById("savepreset_form")
                , c = b.elements.namedItem("id")
                , d = parseInt(c.options[c.selectedIndex].value)
                , e = b.elements.namedItem("categories[]")
                , f = b.elements.namedItem("tags[]")
                , h = b.elements.namedItem("name")
                , k = document.getElementById("savepreset_img");
            if (0 == d) {
                for (var m = 0; m < e.options.length; m++)
                    e.options[m].selected && (e.options[m].selected = !1);
                e.options[e.options.length - 1].selected = !0;
                for (m = 0; m < f.options.length; m++)
                    f.options[m].selected && (f.options[m].selected = !1);
                k.src = ""
            } else {
                a = null;
                for (m = 0; m < B.length; m++)
                    if (B[m].id == d) {
                        a = B[m];
                        break
                    }
                for (var l = a.categories.split(","), q = a.tags.split(","), m = 0; m < e.options.length; m++)
                    l.includes(e.options[m].text) ? e.options[m].selected = !0 : e.options[m].selected = !1;
                for (m = 0; m < f.options.length; m++)
                    q.includes(f.options[m].text) ? f.options[m].selected = !0 : f.options[m].selected = !1;
                k.src = a.image;
                h.value = a.name
            }
        } catch (n) {
            console.log("\u041e\u0428\u0418\u0411\u041a\u0410 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 savepreset_form_id_change"),
                console.log(n)
        }
    }
    function vb(a) {
        try {
            var b = document.createElement("div");
            b.className = "button data-button-controls bolt";
            a.appendChild(b)
        } catch (c) {
            console.log("\u041e\u0428\u0418\u0411\u041a\u0410 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 add_menu_separator"),
                console.log(c)
        }
    }
    function E(a, b, c, d, e, f) {
        try {
            var g = document.createElement("div");
            g.title = c;
            g.className = f ? "button data-button-controls selectable" : "button data-button-controls";
            a.appendChild(g);
            g.id = b;
            g.addEventListener("click", e);
            var k = document.createElement("span");
            k.classList.add("mobile-title");
            k.innerHTML = g.title;
            g.appendChild(k);
            var m = document.createElement("style");
            m.innerHTML = ".data-button-controls#" + g.id + ":before { background-image: url('../interface/" + d + "');}";
            document.body.appendChild(m)
        } catch (l) {
            console.log("\u041e\u0428\u0418\u0411\u041a\u0410 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 add_functional_button"),
                console.log(l)
        }
    }
    function Ja(a) {
        try {
            var b = document.getElementById(a + "-list-container")
                , c = document.getElementById(a + "-list-header");
            if (b.classList.contains("hidden")) {
                try {
                    a = ["input", "output", "gear", "rider-text"];
                    for (var d = 0; d < a.length; d++) {
                        var e = document.getElementById(a[d] + "-list-container");
                        e.classList.contains("hidden") || (e.classList.add("hidden"),
                            document.getElementById(a[d] + "-list-header").classList.remove("active"))
                    }
                } catch (g) {
                    console.log("\u041e\u0428\u0418\u0411\u041a\u0410 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 hide_all_lists"),
                        console.log(g)
                }
                b.classList.remove("hidden");
                c.classList.add("active")
            } else
                b.classList.add("hidden"),
                    c.classList.remove("active")
        } catch (g) {
            console.log("\u041e\u0428\u0418\u0411\u041a\u0410 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 show_list"),
                console.log(g)
        }
    }
    function kc(a) {
        try {
            var b = document.getElementById("main_canvas_container"), c = "title-page rider-text menu-container tabs-container main_canvas_container head controls-container properties-container stage-container list-edit-container gear-list-edit-container output-list-container input-list-container gear-list-container rider-text-list-container".split(" "), d = ["title-page", "gear-list-container", "output-list-container", "input-list-container", "rider-text"], e, g;
            if (isNaN(b.offsetLeft) || isNaN(b.offsetTop)) {
                var h = b.getBoundingClientRect();
                e = h.left;
                g = h.top
            } else
                e = b.offsetLeft,
                    g = b.offsetTop;
            console.log("orgX=" + e + "; orgY=" + g);
            document.getElementById("rider-text").innerHTML = aa;
            for (var k = 0; k < c.length; k++) {
                var m = c[k]
                    , l = document.getElementById(m);
                l ? (l.classList.add("print"),
                d.includes(l.id) && l.classList.contains("hidden") && l.classList.remove("hidden")) : console.log(m)
            }
            for (var q = document.getElementsByClassName("close-button"), k = 0; k < q.length; k++)
                q[k].classList.add("hidden");
            Za = parseFloat(b.firstChild.style.width) / 980;
            $a = parseFloat(b.firstChild.style.height) / 490;
            b.firstChild.style.width = b.style.width = "980px";
            b.firstChild.style.height = b.style.height = "490px";
            isNaN(b.offsetLeft) || isNaN(b.offsetTop) ? (h = b.getBoundingClientRect(),
                ab = h.left - e,
                bb = h.top - g) : (ab = b.offsetLeft - e,
                bb = b.offsetTop - g);
            console.log("_print_chX=" + ab + "; _print_chY=" + bb);
            if (T)
                for (k = 0; k < f.length; k++) {
                    var n = document.getElementById("anchor" + f[k].id);
                    n.style.top = parseInt(parseFloat(n.style.top) / $a) + "px";
                    n.style.left = parseInt(parseFloat(n.style.left) / Za) + "px"
                }
            Fb(a)
        } catch (u) {
            console.log("\u041e\u0428\u0418\u0411\u041a\u0410 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 print_rider"),
                console.log(u)
        }
    }
    function Fb(a) {
        try {
            var b = document.getElementById("main_canvas_container");
            a = "title-page rider-text menu-container tabs-container main_canvas_container head controls-container properties-container stage-container list-edit-container gear-list-edit-container output-list-container input-list-container gear-list-container rider-text-list-container".split(" ");
            var c = ["title-page", "gear-list-container", "output-list-container", "input-list-container", "rider-text"];
            window.print();
            T && Gb.update();
            b.firstChild.style.width = b.style.width = parseInt(parseFloat(b.firstChild.style.width) * Za) + "px";
            b.firstChild.style.height = b.style.height = parseInt(parseFloat(b.firstChild.style.height) * $a) + "px";
            for (b = 0; b < a.length; b++) {
                var d = a[b]
                    , e = document.getElementById(d);
                e ? (e = document.getElementById(d),
                    e.classList.remove("print"),
                c.includes(e.id) && !e.classList.contains("hidden") && e.classList.add("hidden")) : console.log(d)
            }
            for (var f = document.getElementsByClassName("close-button"), b = 0; b < f.length; b++)
                f[b].classList.contains("hidden") && f[b].classList.remove("hidden");
            var h = document.getElementById("gear-list-table-container");
            A(h);
            Eb = !1
        } catch (k) {
            console.log("\u041e\u0428\u0418\u0411\u041a\u0410 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 print_rider_cancel"),
                console.log(k)
        }
    }
    function X() {
        try {
            for (var a = 0; a < f.length; a++) {
                for (var b = 0; b < f[a].input_list.length; b++)
                    f[a].input_list[b].Locked || (f[a].input_list[b].Channel = null);
                for (b = 0; b < f[a].output_list.length; b++)
                    f[a].output_list[b].Locked || (f[a].output_list[b].Channel = null)
            }
            for (a = 0; a < I.length; a++)
                I[a].Locked || (I[a].Channel = null);
            for (a = 0; a < J.length; a++)
                J[a].Locked || (J[a].Channel = null)
        } catch (c) {
            console.log("\u041e\u0428\u0418\u0411\u041a\u0410 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 clear_input_channels"),
                console.log(c)
        }
    }
    function ub(a) {
        try {
            var b = x(a)
                , c = f[b].children;
            Aa.unload(a);
            var d = document.getElementById("anchor" + a);
            d.parentNode.removeChild(d);
            if (c && 0 < c.length)
                for (a = 0; a < c.length; a++)
                    c[a].parent = "";
            f[b].obj = null;
            for (c = 0; c < f[b].input_list.length; c++)
                delete f[b].input_list[c].obj;
            for (c = 0; c < f[b].output_list.length; c++)
                delete f[b].output_list[c].obj;
            for (c = 0; c < f[b].gear_list.length; c++)
                delete f[b].gear_list[c].obj;
            f.splice(b, 1);
            Ia();
            X();
            Z(null);
            L();
            U();
            ea();
            console.log(f)
        } catch (e) {
            console.log("\u041e\u0428\u0418\u0411\u041a\u0410 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 delete_object"),
                console.log(e)
        }
    }
    function tb(a) {
        if (t) {
            Hb(t, a * Ib);
            var b = parseInt(Ib / Math.PI * 180)
                , c = x(t.render.data_id)
                , d = document.getElementById("properties_form");
            a = parseInt(f[c].turn) + a * b;
            360 < a && (a -= 360);
            0 > a && (a += 360);
            f[c].turn = a;
            d.elements.namedItem("turn").value = a
        }
    }
    function wb(a) {
        try {
            console.log("\u041d\u0430\u0447\u0438\u043d\u0430\u0435\u043c \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0438\u0435");
            var b = new XMLHttpRequest;
            b.open("POST", "../rider.php", !1);
            b.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
            _request = b;
            b.onreadystatechange = function() {
                if (200 == this.status) {
                    console.log(_request);
                    console.log(this);
                    console.log("Status \n" + this.status + "\n" + this.readyState + this.responseText);
                    try {
                        var a = JSON.parse(this.responseText);
                        "error" == a.status ? alert("Rider " + N + " has not been saved:" + a.error) : (N = a.id,
                        Ea || alert("Rider " + N + " has been saved"),
                            Xa())
                    } catch (q) {
                        console.log("\u041e\u0428\u0418\u0411\u041a\u0410 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 save_rider JSON.parse"),
                            console.log(q),
                            alert("Rider " + N + " has not been saved")
                    }
                } else
                    console.log(_request),
                        console.log("Status \n" + this.status + "\n" + this.readyState + this.responseText)
            }
            ;
            var c = {
                name: "Stage",
                model_src: "my_project.json",
                X: 0,
                Y: 0,
                Z: 0,
                turn: 0,
                Title: "Stage",
                Comment: ""
            };
            c.input_list = I;
            c.output_list = J;
            c.gear_list = K;
            c.Show_Grid = na;
            c.Show_Channels = T;
            c.Show_CH = sa;
            c.Show_MIX = ta;
            c.Show_Title = ua;
            c.Show_Comments = va;
            c.gear_categories = cb;
            c.Rider_text = aa;
            c.Title = Q;
            c.Comment = La;
            c.Length = db;
            c.children = [];
            Jb();
            for (var d = 0; d <= f.length; d++) {
                var e, g;
                d == f.length ? (e = I,
                    g = J) : (e = f[d].input_list,
                    g = f[d].output_list,
                f[d].parent || c.children.push(f[d]));
                for (var h = 0; h < e.length; h++)
                    e[h].Locked = !0;
                for (h = 0; h < g.length; h++)
                    g[h].Locked = !0
            }
            var k = JSON.stringify(c)
                , c = /"id":([0-9]+?),/g
                , m = k.replace(c, "")
                , c = /("parent":)([0-9]+?),/g
                , k = m.replace(c, "")
                , c = /"parent":"",/g
                , m = k.replace(c, "")
                , c = /"obj":null,/g
                , k = m.replace(c, "")
                , c = /"selected":true,/g
                , m = k.replace(c, "")
                , c = /"Obj_id":([0-9]+?),/g
                , k = m.replace(c, "")
                , c = /,"Zabs":([0-9.-]+?)}/g
                , m = k.replace(c, "}")
                , c = /,"Yabs":([0-9.-]+?)}/g
                , k = m.replace(c, "}")
                , c = /,"Xabs":([0-9.-]+?)}/g
                , m = k.replace(c, "}")
                , c = /,"is_jump":false}/g
                , k = m.replace(c, "}")
                , c = /,"obj":null}/g
                , m = k.replace(c, "}");
            Kb();
            b.send(_CSRF + "=" + _CSRFToken + "&id=" + N + "&name=" + encodeURIComponent(a) + "&stage=" + encodeURIComponent(m) + "&action=save&contact=" + _contact_name + "&phone=" + _phone + "&email=" + _email + "&band=" + _band_name + "&bandlogo=" + _band_logo)
        } catch (l) {
            alert("Save error"),
                console.log(l)
        }
    }
    function uc(a) {
        try {
            Ea = !0;
            document.getElementById("publish").disabled = !0;
            console.log("\u041d\u0430\u0447\u0438\u043d\u0430\u0435\u043c \u043f\u0443\u0431\u043b\u0438\u043a\u0430\u0446\u0438\u044e");
            var b = document.getElementById("publish_form");
            Q = b.elements.namedItem("Title").value;
            _contact_name = b.elements.namedItem("Contact").value;
            _phone = b.elements.namedItem("Phone").value;
            _email = b.elements.namedItem("email").value;
            wb(_rider_name);
            var c = new XMLHttpRequest;
            c.open("POST", "../rider.php", !1);
            c.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
            _request = c;
            c.onreadystatechange = function() {
                if (200 == this.status) {
                    console.log(_request);
                    console.log(this);
                    console.log("Status \n" + this.status + "\n" + this.readyState + this.responseText);
                    try {
                        var a = JSON.parse(this.responseText);
                        "error" == a.status ? alert("Rider " + N + " has not been published:" + a.error) : (window.onunload = null,
                            window.onbeforeunload = null,
                            document.location = "/build/pub.php?id=" + N)
                    } catch (e) {
                        console.log("\u041e\u0428\u0418\u0411\u041a\u0410 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 publish_rider JSON.parse"),
                            console.log(e),
                            alert("Rider " + N + " has not been published")
                    }
                } else
                    console.log(_request),
                        console.log("Status \n" + this.status + "\n" + this.readyState + this.responseText)
            }
            ;
            c.send(_CSRF + "=" + _CSRFToken + "&id=" + N + "&action=publish")
        } catch (d) {
            alert("Publish error"),
                console.log(d)
        }
    }
    function lc() {
        try {
            if (t) {
                var a = x(t.render.data_id);
                Jb();
                Lb(f[a]);
                var b = JSON.stringify(f[a]);
                Mb(f[a]);
                Kb();
                var a = /"id":([0-9]+?),/g
                    , c = b.replace(a, "")
                    , a = /("parent":)([0-9]+?),/g
                    , b = c.replace(a, "")
                    , a = /"parent":"",/g
                    , c = b.replace(a, "")
                    , a = /"obj":null,/g
                    , b = c.replace(a, "")
                    , a = /"selected":true,/g
                    , c = b.replace(a, "")
                    , a = /,"Obj_id":([0-9]+?)}/g
                    , b = c.replace(a, "}")
                    , a = /,"Zabs":([0-9.-]+?)}/g
                    , c = b.replace(a, "}")
                    , a = /,"Yabs":([0-9.-]+?)}/g
                    , b = c.replace(a, "}")
                    , a = /,"Xabs":([0-9.-]+?)}/g
                    , c = b.replace(a, "}")
                    , a = /,"is_jump":false}/g
                    , b = c.replace(a, "}")
                    , a = /,"obj":null}/g
                    , c = b.replace(a, "}");
                pa();
                var d = document.getElementById("savepreset_form")
                    , e = new FormData(d);
                e.append("action", "save");
                e.append(_CSRF, _CSRFToken);
                e.append("preset", c);
                console.log("\u041d\u0430\u0447\u0438\u043d\u0430\u0435\u043c \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0438\u0435");
                var g = new XMLHttpRequest;
                g.open("POST", "../preset.php", !1);
                _request = g;
                g.send(e);
                if (200 == g.status)
                    try {
                        var h = JSON.parse(g.responseText);
                        if ("error" == h.status)
                            alert("Preset has not been saved:" + h.error);
                        else {
                            Ea || alert("Preset has been saved");
                            var k = document.getElementById("savepreset-form-container");
                            A(k);
                            Cb()
                        }
                    } catch (m) {
                        console.log("\u041e\u0428\u0418\u0411\u041a\u0410 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 save_preset JSON.parse"),
                            console.log(m),
                            alert("Preset has not been saved")
                    }
                else
                    alert("\u041e\u0428\u0418\u0411\u041a\u0410 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 save_preset"),
                        console.log("\u041e\u0448\u0438\u0431\u043a\u0430  \u0440\u0430\u0439\u0434\u0435\u0440\u0430"),
                        console.log(g),
                        console.log(g.responseText);
                Ma()
            } else
                alert("Please, select object to save preset")
        } catch (m) {
            console.log("\u041e\u0428\u0418\u0411\u041a\u0410 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 save_preset"),
                console.log(m)
        }
    }
    function Ia() {
        for (var a = 0; a < f.length; a++)
            f[a].children = [];
        for (a = 0; a < f.length; a++)
            if (f[a].parent) {
                var b = x(f[a].parent);
                0 <= b && f[b].children.push(f[a])
            }
    }
    function Jb() {
        try {
            for (var a = 0; a < f.length; a++) {
                f[a].obj = null;
                for (var b = 0; b < f[a].input_list.length; b++)
                    delete f[a].input_list[b].obj;
                for (b = 0; b < f[a].output_list.length; b++)
                    delete f[a].output_list[b].obj;
                for (b = 0; b < f[a].gear_list.length; b++)
                    delete f[a].gear_list[b].obj
            }
        } catch (c) {
            console.log("\u041e\u0428\u0418\u0411\u041a\u0410 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 delete_objects_temporary"),
                console.log(c)
        }
    }
    function Kb() {
        try {
            for (var a = 0; a < f.length; a++)
                for (var b = p.get_all_objects("ALL"), a = 0; a < b.length; a++) {
                    var c = b[a];
                    if (D.is_mesh(c)) {
                        var d = x(c.render.data_id);
                        if (0 < d) {
                            f[d].obj = c;
                            for (var e = 0; e < f[d].input_list.length; e++)
                                f[d].input_list[e].obj = c;
                            for (e = 0; e < f[d].output_list.length; e++)
                                f[d].output_list[e].obj = c;
                            for (e = 0; e < f[d].gear_list.length; e++)
                                f[d].gear_list[e].obj = c
                        }
                    }
                }
        } catch (g) {
            console.log("\u041e\u0428\u0418\u0411\u041a\u0410 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 return_objects_temporary"),
                console.log(g)
        }
    }
    function pa() {
        try {
            document.body.style.cursor = "wait";
            for (var a = document.getElementsByClassName("button"), b = 0; b < a.length; b++)
                a[b].style.cursor = "wait";
            var c = document.getElementById("waiticon");
            c.classList.contains("run") || c.classList.add("run");
            c.classList.contains("hidden") && c.classList.remove("hidden")
        } catch (d) {
            console.log("\u041e\u0428\u0418\u0411\u041a\u0410 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 cursor_to_wait"),
                console.log(d)
        }
    }
    function Va() {
        document.body.style.cursor = "alias";
        for (var a = document.getElementsByClassName("button"), b = 0; b < a.length; b++)
            a[b].style.cursor = "wait"
    }
    function Ma() {
        try {
            document.body.style.cursor = "default";
            for (var a = document.getElementsByClassName("button"), b = 0; b < a.length; b++)
                a[b].style.cursor = "pointer";
            var c = document.getElementById("waiticon");
            c.classList.contains("hidden") || (c.classList.add("hidden"),
                c.style.left = null,
                c.style.top = null)
        } catch (d) {
            console.log("\u041e\u0428\u0418\u0411\u041a\u0410 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 cursor_to_default"),
                console.log(d)
        }
    }
    function mc() {
        try {
            var a = document.getElementById("addobject_form")
                , b = a.elements.namedItem("object")
                , c = b.options[b.selectedIndex].text;
            if ("Upload New Object" == c) {
                var d = new FormData(a);
                d.append("action", "create");
                d.append(_CSRF, _CSRFToken);
                var e = new XMLHttpRequest;
                e.open("POST", "../model.php", !1);
                pa();
                e.send(d);
                if (200 == e.status)
                    try {
                        var g = JSON.parse(e.responseText);
                        if ("error" == g.status)
                            alert("3d object has not been uploaded:" + g.error);
                        else {
                            Ea || alert("3d object was uploaded as " + g.name);
                            var h = {};
                            h.name = g.name;
                            h.Title = g.name;
                            h.Comment = "";
                            h.model_src = g.name + ".json";
                            h.X = 0;
                            h.Y = 0;
                            h.Z = parseFloat(a.elements.namedItem("Z").value);
                            h.Is_Structure = a.elements.namedItem("structure").checked;
                            h.Height = parseFloat(a.elements.namedItem("Height").value);
                            h.turn = 0;
                            h.Locked = !1;
                            h.Title_to_Source = a.elements.namedItem("Title_to_Source").checked;
                            h.children = [];
                            h.input_list = [];
                            h.output_list = [];
                            h.gear_list = [];
                            R = 1;
                            M = !0;
                            F = h;
                            ba = f.length;
                            Fa(h);
                            var k = document.getElementById("addobject-form-container");
                            A(k);
                            Bb()
                        }
                    } catch (m) {
                        console.log("\u041e\u0428\u0418\u0411\u041a\u0410 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 add_object"),
                            console.log(m),
                            alert("3d object was uploaded with errors")
                    }
                else
                    alert("Error while uploading object"),
                        console.log("\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u044f \u0440\u0430\u0439\u0434\u0435\u0440\u0430"),
                        console.log(e),
                        console.log(e.responseText);
                Ma()
            } else
                h = {},
                    h.name = c,
                    h.Title = c,
                    h.Comment = "",
                    h.model_src = c + ".json",
                    h.X = 0,
                    h.Y = 0,
                    h.Z = parseFloat(a.elements.namedItem("Z").value),
                    h.Is_Structure = a.elements.namedItem("structure").checked,
                    h.Height = parseFloat(a.elements.namedItem("Height").value),
                    h.turn = 0,
                    h.Locked = !1,
                    h.Title_to_Source = a.elements.namedItem("Title_to_Source").checked,
                    h.children = [],
                    h.input_list = [],
                    h.output_list = [],
                    h.gear_list = [],
                    R = 1,
                    M = !0,
                    F = h,
                    ba = f.length,
                    Fa(h),
                    k = document.getElementById("addobject-form-container"),
                    A(k)
        } catch (m) {
            console.log("\u041e\u0428\u0418\u0411\u041a\u0410 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 add_object"),
                console.log(m)
        }
    }
    function nc() {
        try {
            var a = document.getElementById("restore_form").elements.namedItem("rider");
            qb("../rider.php?id=" + a.options[a.selectedIndex].value);
            var b = document.getElementById("restore-form-container");
            A(b)
        } catch (c) {
            console.log("\u041e\u0428\u0418\u0411\u041a\u0410 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 restore_rider"),
                console.log(c)
        }
    }
    function oc() {
        try {
            var a = document.getElementById("restore_form").elements.namedItem("rider")
                , b = a.options[a.selectedIndex].value
                , c = new XMLHttpRequest;
            c.open("POST", "../rider.php", !1);
            c.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
            c.send(_CSRF + "=" + _CSRFToken + "&action=deleterider&id=" + b + "&name=" + Q);
            if (200 == c.status) {
                var d = JSON.parse(c.responseText);
                console.log(d);
                Xa();
                Ea || alert("Rider " + d.name + "(" + d.id + ") has been deleted")
            } else
                console.log("\u041e\u0448\u0438\u0431\u043a\u0430 \u0443\u0434\u0430\u043b\u0435\u043d\u0438\u044f \u0440\u0430\u0439\u0434\u0435\u0440\u0430"),
                    alert("Rider " + d.name + "(" + d.id + ") has NOT been deleted. System error"),
                    console.log(c),
                    console.log(c.responseText)
        } catch (e) {
            console.log("\u041e\u0428\u0418\u0411\u041a\u0410 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 delete_rider"),
                console.log(e)
        }
    }
    function qb(a) {
        try {
            if (0 < f.length)
                for (var b = f.length - 1; 0 <= b; b--)
                    ub(f[b].id);
            var c = new XMLHttpRequest, d;
            if (a.includes("../rider.php?id=")) {
                c.open("POST", "../rider.php", !1);
                c.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
                var e = _CSRF + "=" + _CSRFToken + "&action=getrider&" + a.split("?")[1];
                c.send(e);
                if (200 == c.status) {
                    var g = JSON.parse(c.responseText);
                    d = JSON.parse(g.rider.JSON);
                    console.log(d);
                    N = g.rider.id;
                    _rider_name = g.rider.name;
                    _rider_title = g.rider.title;
                    _contact_name = g.rider.contact;
                    _phone = g.rider.phone;
                    _email = g.rider.email;
                    _band_name = g.rider.band_name;
                    _band_logo = g.rider.band_logo;
                    if (Nb = "public" == g.rider.status) {
                        var h = document.getElementById("publish");
                        h.disabled = !0;
                        h.value = "Rider already published"
                    }
                } else {
                    console.log("\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u044f \u0440\u0430\u0439\u0434\u0435\u0440\u0430");
                    console.log(c);
                    console.log(c.responseText);
                    return
                }
            } else
                c.open("GET", a, !1),
                    c.send(null),
                    d = JSON.parse(c.responseText);
            d.input_list && (I = d.input_list);
            d.output_list && (J = d.output_list);
            d.gear_list && (K = d.gear_list);
            for (b = 0; b < K.length; b++)
                K[b].Obj_id = "Stage",
                    K[b].obj = null;
            na = d.Show_Grid;
            T = d.Show_Channels;
            sa = d.Show_CH;
            ta = d.Show_MIX;
            ua = d.Show_Title;
            va = d.Show_Comments;
            eb = 0 != d.Use_Borders;
            d.gear_categories && (cb = d.gear_categories);
            aa = d.Rider_text;
            Q = _load_rider ? d.Title : _rider_title;
            La = d.Comment;
            db = d.Length;
            var k = document.getElementById("stage_form")
                , m = document.getElementById("publish_form");
            k.elements.namedItem("Length").value = d.Length;
            k.elements.namedItem("Text").value = aa;
            tinymce.activeEditor.setContent(aa);
            k.elements.namedItem("Title").value = Q;
            k.elements.namedItem("Contact").value = _contact_name;
            k.elements.namedItem("Phone").value = _phone;
            k.elements.namedItem("email").value = _email;
            m.elements.namedItem("Title").value = Q;
            m.elements.namedItem("Contact").value = _contact_name;
            m.elements.namedItem("Phone").value = _phone;
            m.elements.namedItem("email").value = _email;
            k.elements.namedItem("band").value = _band_name;
            k.elements.namedItem("bandlogo").value = _band_logo;
            document.getElementById("title-page-title").innerHTML = Q;
            document.getElementById("title-page-contact").innerHTML = _contact_name;
            document.getElementById("title-page-phone").innerHTML = _phone;
            document.getElementById("title-page-email").innerHTML = _email;
            document.getElementById("title-page-bandname").innerHTML = _band_name;
            document.getElementById("title-page-logo").src = _band_logo;
            var l = new Date
                , q = l.getDate() + "-" + (l.getMonth() + 1) + "-" + l.getFullYear();
            document.getElementById("title-page-date").innerHTML = q;
            a = "http://soundcheckbox.com/build/pub.php?id=" + N;
            document.getElementById("title-page-rider-link").innerHTML = '<a href="' + a + '"><img src="https://chart.googleapis.com/chart?cht=qr&chs=150x150&chl=' + a + '" /></a><br/><a href="' + a + '">' + a + "</a>";
            k.elements.namedItem("Comment").value = La;
            k.elements.namedItem("showtitle").checked = ua;
            k.elements.namedItem("showch").checked = sa;
            k.elements.namedItem("showmix").checked = ta;
            k.elements.namedItem("showcomments").checked = va;
            xb();
            0 < d.children.length ? (F = d,
                R = 0,
                Ga = M = !0,
                ba = 0,
                pa(),
                fb(F),
                Fa(F)) : (console.log("Stage is empty"),
                ea())
        } catch (n) {
            alert("Restore error"),
                console.log(n)
        }
    }
    function Ya(a) {
        console.log("load_from_preset");
        try {
            for (var b = "", c = null, d = -1, e = 0; e < B.length; e++)
                if (B[e].id == a && (d = e,
                B[e].JSON && 0 < B[e].JSON.length)) {
                    c = B[e].JSON;
                    b = JSON.parse(B[e].JSON);
                    break
                }
            if (null == c) {
                var g = new XMLHttpRequest;
                g.open("POST", "../preset.php", !1);
                g.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
                g.send(_CSRF + "=" + _CSRFToken + "&action=get&id=" + a);
                var h = JSON.parse(g.responseText);
                if ("OK" == h.status && h.preset && h.preset.JSON)
                    b = JSON.parse(h.preset.JSON),
                        B[d].JSON = h.preset.JSON;
                else {
                    console.log("\u041e\u0428\u0418\u0411\u041a\u0410 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 load_from_preset: ");
                    console.log(g);
                    console.log(h);
                    return
                }
            }
            R = 1;
            M = !0;
            F = b;
            ba = f.length;
            F.children && 0 < F.children.length && fb(F);
            Fa(b)
        } catch (k) {
            console.log("\u041e\u0428\u0418\u0411\u041a\u0410 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 load_from_preset"),
                console.log(k)
        }
    }
    function Fa(a) {
        try {
            if ("my_project.json" != a.model_src && Aa.load(Ta + a.model_src, Cc, null, null, !0),
            F.children && 0 < a.children.length)
                for (var b = 0; b < a.children.length; b++)
                    Ga || void 0 !== a.children[b].relative_coord && 1 != a.children[b].relative_coord || (a.children[b].X += a.X,
                        a.children[b].Y += a.Y,
                    void 0 === a.children[b].Z && (a.children[b].Z = 0),
                    void 0 === a.Z && (a.Z = 0),
                        a.children[b].Z += a.Z),
                        Fa(a.children[b])
        } catch (c) {
            console.log("\u041e\u0428\u0418\u0411\u041a\u0410 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 load_models_from_preset"),
                console.log(c)
        }
    }
    function fb(a) {
        try {
            if (!a.children)
                console.log("\u041f\u0440\u0435\u0434\u0430\u0442\u0435\u043b\u044c"),
                    console.log(a),
                    a.children = [];
            else if (0 < a.children.length)
                for (var b = 0; b < a.children.length; b++) {
                    R++;
                    if (a.children[b].src) {
                        var c = new XMLHttpRequest;
                        c.open("GET", "../presets/" + a.children[b].src, !1);
                        c.send(null);
                        var d = JSON.parse(c.responseText);
                        d.X = a.children[b].X;
                        d.Y = a.children[b].Y;
                        d.turn = a.children[b].turn;
                        a.children[b] = d;
                        delete a.children[b].src
                    } else
                        d = a.children[b];
                    fb(d)
                }
        } catch (e) {
            console.log("\u041e\u0428\u0418\u0411\u041a\u0410 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 explode_preset"),
                console.log(e)
        }
    }
    function x(a) {
        for (var b = 0; b < f.length; b++)
            if (f[b].id == a)
                return b;
        return -1
    }
    function Cc(a) {
        try {
            var b = p.get_all_objects("ALL", a);
            for (a = 0; a < b.length; a++) {
                var c = b[a];
                if (Ob.has_physics(c)) {
                    Ob.enable_simulation(c);
                    var d = ga.create_collision_sensor(c, "MUSICOBJ")
                        , e = ga.create_selection_sensor(c, !0);
                    c == t && ga.set_custom_sensor(e, 1);
                    ga.create_sensor_manifold(c, "COLLISION", ga.CT_CONTINUOUS, [d, e], Dc, Ec);
                    var f = D.get_parent(c);
                    f && D.is_armature(f) ? y.set_translation_v(f, Ua) : y.set_translation_v(c, Ua)
                }
                if (D.is_mesh(c) && (p.show_object(c),
                    M)) {
                    var h = document.createElement("span");
                    h.id = "anchor" + c.render.data_id;
                    h.classList.add("anchor");
                    document.getElementById("main_canvas_container").appendChild(h);
                    Gb.attach_move_cb(c.cons_descends[0], function(a, b, c, d, e) {
                        c = document.getElementById("anchor" + d.render.data_id);
                        c.style.left = a + "px";
                        c.style.top = b + "px";
                        c.style.visibility = T ? "visible" : "hidden"
                    });
                    Fc(c)
                }
            }
        } catch (k) {
            console.log("\u041e\u0428\u0418\u0411\u041a\u0410 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 loaded_cb"),
                console.log(k)
        }
    }
    function yb(a) {
        try {
            var b = document.getElementById("properties_form").elements.namedItem("ID").value
                , c = x(b)
                , d = document.getElementById("input_list_table");
            if (!d) {
                d = document.createElement("table");
                d.id = "input_list_table";
                d.classList.add("info-table");
                var e = document.getElementById("input-list-container");
                e.innerHTML = "<h2>input List (" + (d.rows.length - 1) + ")</h2>";
                document.getElementById("input-list-header").innerHTML = "Input List (" + (d.rows.length - 1) + ")";
                e.appendChild(d)
            }
            var g = Na(d, O);
            a = {
                Source: "NEW",
                Type: "NEW",
                ChName: "NEW",
                Comment: ""
            };
            a.Channel = g;
            0 <= c ? (a.Obj_id = f[c].id,
                a.obj = f[c].obj,
                f[c].input_list.push(a)) : I.push(a);
            X();
            L()
        } catch (h) {
            console.log("\u041e\u0428\u0418\u0411\u041a\u0410 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 add_input"),
                console.log(h)
        }
    }
    function Na(a, b) {
        try {
            if (1 < a.rows.length) {
                b || (b = O);
                for (var c = 1; c < a.rows.length; c++)
                    if (c < parseInt(a.rows[c].cells[0].innerHTML) && !(c in b))
                        return c;
                return a.rows.length
            }
            return 1
        } catch (d) {
            console.log("\u041e\u0428\u0418\u0411\u041a\u0410 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 find_empty_channel"),
                console.log(d)
        }
    }
    function zb(a) {
        try {
            var b = document.getElementById("properties_form").elements.namedItem("ID").value
                , c = x(b)
                , d = document.getElementById("output_list_table");
            if (!d) {
                d = document.createElement("table");
                d.id = "output_list_table";
                d.classList.add("info-table");
                var e = document.getElementById("output-list-container");
                e.innerHTML = "<h2>output List (" + (d.rows.length - 1) + ")</h2>";
                e.appendChild(d);
                document.getElementById("output-list-header").innerHTML = "output List (" + (d.rows.length - 1) + ")"
            }
            var g = Na(d, ha);
            a = {
                Source: "NEW",
                Type: "NEW",
                ChName: "NEW",
                Comment: ""
            };
            a.Channel = g;
            0 <= c ? (a.Obj_id = f[c].id,
                a.obj = f[c].obj,
                f[c].output_list.push(a)) : J.push(a);
            U()
        } catch (h) {
            console.log("\u041e\u0428\u0418\u0411\u041a\u0410 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 add_output"),
                console.log(h)
        }
    }
    function Ab(a) {
        try {
            var b = document.getElementById("properties_form").elements.namedItem("ID").value
                , c = x(b);
            a = {
                Name: "NEW",
                Image: "",
                Comment: "NEW",
                Weight: 0,
                Weight_round: 1,
                Count: 1,
                Count_round: 1,
                Owner: "Rent",
                Power_consumption: 0,
                Category: "Stage Gears"
            };
            0 <= c ? (a.Obj_id = f[c].id,
                a.obj = f[c].obj,
                f[c].gear_list.push(a)) : (a.Obj_id = "Stage",
                a.Category = "Stage NEW",
                a.obj = null,
                K.push(a));
            ea()
        } catch (d) {
            console.log("\u041e\u0428\u0418\u0411\u041a\u0410 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 add_gear"),
                console.log(d)
        }
    }
    function Da(a) {
        a = document.getElementById("beforepub");
        var b = document.getElementById("publish")
            , c = document.getElementById("publish_form")
            , d = c.elements.namedItem("Title")
            , e = c.elements.namedItem("Contact")
            , f = c.elements.namedItem("Phone")
            , c = c.elements.namedItem("email");
        0 < d.value.length && 0 < e.value.length && 0 < f.value.length && 0 < c.value.length && 0 < aa.length && "This rider was created by SoundCheckBox.com" != aa ? (b.disabled = !1,
        a.classList.contains("hidden") || a.classList.add("hidden")) : Nb || (b.disabled = !0,
        a.classList.contains("hidden") && a.classList.remove("hidden"))
    }
    function xb(a) {
        try {
            var b = document.getElementById("stage_form")
                , c = parseFloat(b.elements.namedItem("Length").value);
            aa = b.elements.namedItem("Text").value;
            db = c;
            Q = b.elements.namedItem("Title").value;
            _contact_name = b.elements.namedItem("Contact").value;
            _phone = b.elements.namedItem("Phone").value;
            _email = b.elements.namedItem("email").value;
            _band_name = b.elements.namedItem("band").value;
            _band_logo = b.elements.namedItem("bandlogo").value;
            La = b.elements.namedItem("Comment").value;
            ua = b.elements.namedItem("showtitle").checked;
            sa = b.elements.namedItem("showch").checked;
            ta = b.elements.namedItem("showmix").checked;
            va = b.elements.namedItem("showcomments").checked;
            eb = b.elements.namedItem("useborder").checked;
            var d = document.getElementById("publish_form");
            d.elements.namedItem("Title").value = Q;
            d.elements.namedItem("Contact").value = _contact_name;
            d.elements.namedItem("Phone").value = _phone;
            d.elements.namedItem("email").value = _email;
            document.getElementById("title-page-title").innerHTML = Q;
            document.getElementById("title-page-contact").innerHTML = _contact_name;
            document.getElementById("title-page-phone").innerHTML = _phone;
            document.getElementById("title-page-email").innerHTML = _email;
            document.getElementById("title-page-bandname").innerHTML = _band_name;
            document.getElementById("title-page-logo").src = _band_logo;
            var e = new Date
                , f = e.getDate() + "-" + (e.getMonth() + 1) + "-" + e.getFullYear();
            document.getElementById("title-page-date").innerHTML = f;
            Da();
            if (c && 0 < c) {
                a = c / 20;
                var h = p.get_object_by_name("Stage");
                y.set_scale(h, a);
                wa = 5 * a;
                ia = -5 * a;
                xa = 10 * a;
                ja = -10 * a
            }
            L();
            U()
        } catch (k) {
            console.log("\u041e\u0428\u0418\u0411\u041a\u0410 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 save_stage_prop"),
                console.log(k)
        }
    }
    function Pb(a) {
        try {
            for (var b = 0; b < a.children.length; b++)
                a.children[b].Locked = !0,
                a.children[b].children && 0 < a.children[b].children.length && Pb(a.children[b])
        } catch (c) {
            console.log("\u041e\u0428\u0418\u0411\u041a\u0410 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 lock_all_children"),
                console.log(c)
        }
    }
    function Oa(a) {
        try {
            if (ua || va || sa || ta) {
                var b = document.getElementById("anchor" + a.id);
                b.innerHTML = "";
                if (ua || t == a.obj)
                    b.innerHTML += "<b>" + a.Title + "</b>";
                if ((sa || t == a.obj) && 0 < a.input_list.length) {
                    b.innerHTML += " (CH " + a.input_list[0].Channel;
                    for (var c = 1; c < a.input_list.length; c++)
                        b.innerHTML += "," + a.input_list[c].Channel;
                    b.innerHTML += ")";
                    b.classList.contains("ch") || b.classList.add("ch")
                } else
                    b.classList.remove("ch");
                if ((ta || t == a.obj) && 0 < a.output_list.length) {
                    b.innerHTML += "(MIX " + a.output_list[0].Channel;
                    for (c = 1; c < a.output_list.length; c++)
                        b.innerHTML += "," + a.output_list[c].Channel;
                    b.innerHTML += ")";
                    b.classList.contains("mix") || b.classList.add("mix")
                } else
                    b.classList.remove("mix");
                va && (b.innerHTML += "<br/><i>" + a.Comment + "</i>")
            }
        } catch (d) {
            console.log("\u041e\u0428\u0418\u0411\u041a\u0410 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 update_anchor"),
                console.log(d)
        }
    }
    function pc(a) {
        try {
            var b = document.getElementById("properties_form")
                , c = b.elements.namedItem("ID").value
                , d = x(c);
            if (0 <= d) {
                f[d].Title = b.elements.namedItem("Title").value;
                f[d].Comment = b.elements.namedItem("Comment").value;
                f[d].Locked = b.elements.namedItem("lock").checked;
                f[d].Title_to_Source = b.elements.namedItem("titletosource").checked;
                b.elements.namedItem("lockall").checked && 0 < f[d].children.length && Pb(f[d]);
                if (f[d].Title_to_Source)
                    for (a = 0; a < f[d].input_list.length; a++)
                        f[d].input_list[a].Source = f[d].Title;
                Qb(f[d].obj, b.elements.namedItem("Parent").value);
                Oa(f[d])
            }
            L();
            var e = document.getElementById("properties-form-container");
            A(e)
        } catch (g) {
            console.log("\u041e\u0428\u0418\u0411\u041a\u0410 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 save_prop"),
                console.log(g)
        }
    }
    function qc(a) {
        try {
            var b = document.getElementById("list_edit_form")
                , c = document.getElementById("list-edit-container");
            A(c);
            var d = b.elements.namedItem("ID").value.split("_")
                , e = x(d[1]);
            if ("CH" == d[3]) {
                var g;
                g = "Stage" == d[1] ? I : f[e].input_list;
                g[d[2]].ChName = b.elements.namedItem("Name").value;
                g[d[2]].Source = b.elements.namedItem("Source").value;
                g[d[2]].Type = b.elements.namedItem("Type").value;
                g[d[2]].Comment = b.elements.namedItem("Comment").value;
                var h = g[d[2]].Locked = b.elements.namedItem("Locked").checked
                    , k = parseInt(b.elements.namedItem("Channel").value);
                if (k != g[d[2]].Channel)
                    O.includes(k) ? alert("Channel No " + k + " already busy and locked. Use another channel or unlock that one") : g[d[2]].Channel = k,
                        X(),
                        U(),
                        S(document.getElementById("output_list_table"));
                else if (h && !O.includes(k))
                    O.push(k);
                else if (!h && O.includes(k)) {
                    var m = O.indexOf(k);
                    -1 < m && O.splice(m, 1)
                }
                L();
                S(document.getElementById("input_list_table"))
            } else
                "MIX" == d[3] && (g = "Stage" == d[1] ? J : f[e].output_list,
                    g[d[2]].ChName = b.elements.namedItem("Name").value,
                    g[d[2]].Source = b.elements.namedItem("Source").value,
                    g[d[2]].Type = b.elements.namedItem("Type").value,
                    g[d[2]].Comment = b.elements.namedItem("Comment").value,
                    h = g[d[2]].Locked = b.elements.namedItem("Locked").checked,
                    k = parseInt(b.elements.namedItem("Channel").value),
                    k != g[d[2]].Channel ? (k in ha ? alert("Channel No " + k + " already busy and locked. Use another channel or unlock that one") : g[d[2]].Channel = k,
                        X(),
                        L(),
                        S(document.getElementById("input_list_table"))) : !h || k in ha || ha.push(k),
                    U(),
                    S(document.getElementById("output_list_table")))
        } catch (l) {
            console.log("\u041e\u0428\u0418\u0411\u041a\u0410 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 save_list_row"),
                console.log(l)
        }
    }
    function sc(a) {
        try {
            var b = document.getElementById("gear_list_edit_form")
                , c = document.getElementById("gear-list-edit-container");
            A(c);
            var d = b.elements.namedItem("ID").value.split("_"), e;
            if ("Stage" == d[1])
                e = K[d[2]];
            else {
                var g = x(d[1]);
                e = f[g].gear_list[d[2]]
            }
            e.Name = b.elements.namedItem("Name").value;
            e.Category = b.elements.namedItem("Category").value;
            e.Image = b.elements.namedItem("Image").value;
            e.Comment = b.elements.namedItem("Comment").value;
            e.Weight = parseFloat(b.elements.namedItem("Weight").value);
            e.Count = parseFloat(b.elements.namedItem("Count").value);
            e.Power_consumption = parseInt(b.elements.namedItem("Power").value);
            e.Owner = b.elements.namedItem("Owner").value;
            var h = document.getElementById("gear-list-table-container");
            ea();
            A(h)
        } catch (k) {
            console.log("\u041e\u0428\u0418\u0411\u041a\u0410 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 save_gear_list_row"),
                console.log(k)
        }
    }
    function rc(a) {
        try {
            var b = document.getElementById("list_edit_form")
                , c = document.getElementById("list-edit-container");
            A(c);
            var d = b.elements.namedItem("ID").value.split("_");
            if ("Stage" == d[1])
                "CH" == d[3] ? I.splice(d[2], 1) : "MIX" == d[3] && J.splice(d[2], 1);
            else {
                var e = x(d[1]);
                "CH" == d[3] ? f[e].input_list.splice(d[2], 1) : "MIX" == d[3] && f[e].output_list.splice(d[2], 1)
            }
            X();
            L();
            U();
            S(document.getElementById("input_list_table"));
            S(document.getElementById("output_list_table"))
        } catch (g) {
            console.log("\u041e\u0428\u0418\u0411\u041a\u0410 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 delete_list_row"),
                console.log(g)
        }
    }
    function tc(a) {
        try {
            var b = document.getElementById("gear_list_edit_form")
                , c = document.getElementById("gear-list-edit-container");
            A(c);
            var d = b.elements.namedItem("ID").value.split("_");
            if ("Stage" == d[1])
                K.splice(d[2], 1);
            else {
                var e = x(d[1]);
                f[e].gear_list.splice(d[2], 1)
            }
            ea();
            var g = document.getElementById("gear-list-table-container");
            A(g)
        } catch (h) {
            console.log("\u041e\u0428\u0418\u0411\u041a\u0410 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 delete_gear_list_row"),
                console.log(h)
        }
    }
    function Rb(a) {
        try {
            var b, c, d, e, f, h;
            for (c = !0; c; ) {
                c = !1;
                b = a.rows;
                for (d = 1; d < b.length - 1; d++)
                    if (h = !1,
                        e = b[d].getElementsByTagName("TD")[0],
                        f = b[d + 1].getElementsByTagName("TD")[0],
                    parseInt(e.innerHTML) > parseInt(f.innerHTML)) {
                        h = !0;
                        break
                    }
                h && (b[d].parentNode.insertBefore(b[d + 1], b[d]),
                    c = !0)
            }
        } catch (k) {
            console.log("\u041e\u0428\u0418\u0411\u041a\u0410 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 sortTable"),
                console.log(k)
        }
    }
    function Gc(a) {
        try {
            var b, c, d;
            for (b = !0; b; ) {
                b = !1;
                for (c = 0; c < a.length - 1; c++)
                    if (d = !1,
                    a[c].Index > a[c + 1].Index) {
                        d = !0;
                        break
                    }
                d && (a.splice(c, 2, a[c + 1], a[c]),
                    b = !0)
            }
        } catch (e) {
            console.log("\u041e\u0428\u0418\u0411\u041a\u0410 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 gear_sort_categories"),
                console.log(e)
        }
    }
    function Hc(a) {
        try {
            if (1 < a.rows.length)
                for (var b = parseInt(a.rows[a.rows.length - 1].cells[0].innerHTML), c = 1; c < b; c++) {
                    var d = a.rows[c].cells;
                    if (parseInt(d[0].innerHTML) != c) {
                        console.log("Ch:" + d[0].innerHTML + "!=" + c);
                        var e = a.insertRow();
                        e.insertCell().innerHTML = c;
                        for (var f = 0; f < d.length - 1; f++)
                            e.insertCell();
                        a.rows[c].parentNode.insertBefore(e, a.rows[c])
                    }
                }
        } catch (h) {
            console.log("\u041e\u0428\u0418\u0411\u041a\u0410 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 fill_empty_channels"),
                console.log(h)
        }
    }
    function S(a) {
        try {
            a.classList.contains("noedit-mode") ? a.classList.remove("noedit-mode") : a.classList.add("noedit-mode")
        } catch (b) {
            console.log("\u041e\u0428\u0418\u0411\u041a\u0410 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 noedit_mode"),
                console.log(b)
        }
    }
    function L(a) {
        try {
            a || (a = "input");
            var b, c, d;
            d = document.createElement("table");
            d.id = a + "_list_table";
            d.classList.add("info-table");
            d.classList.add("noedit-mode");
            c = d.insertRow();
            var e = document.createElement("TH");
            e.innerHTML = "\u2116";
            c.appendChild(e);
            e = document.createElement("TH");
            e.innerHTML = "";
            c.appendChild(e);
            e = document.createElement("TH");
            e.innerHTML = "Source";
            c.appendChild(e);
            e = document.createElement("TH");
            e.innerHTML = "Type";
            c.appendChild(e);
            e = document.createElement("TH");
            e.innerHTML = "Name";
            c.appendChild(e);
            e = document.createElement("TH");
            e.innerHTML = "Comment";
            c.appendChild(e);
            e = document.createElement("TH");
            e.innerHTML = "";
            c.appendChild(e);
            for (var g = e = 0; g < f.length; g++) {
                var h = f[g];
                if (h) {
                    var k, m, l;
                    if ("input" == a)
                        k = h.input_list,
                            m = "CH",
                            l = O;
                    else if ("output" == a)
                        k = h.output_list,
                            m = "MIX",
                            l = ha;
                    else
                        return;
                    if (k && 0 < k.length)
                        for (var q = 0; q < k.length; q++) {
                            e++;
                            var n = k[q];
                            n.Channel || (n.Channel = Na(d, l));
                            0 == q && m && Oa(h);
                            c = d.insertRow();
                            c.id = "id_" + n.Obj_id + "_" + q + "_" + m;
                            n.obj == t && c.classList.add("selected_row");
                            c.classList.add("input_" + n.Obj_id);
                            var u = function(a) {
                                return function() {
                                    gb(a)
                                }
                            };
                            b = c.insertCell();
                            b.innerHTML = n.Channel;
                            b.onclick = u(c);
                            var Ba = "";
                            if ("input" == a) {
                                var z = document.createElement("sup");
                                z.innerHTML = "+48v";
                                z.onclick = function(a, b) {
                                    return function() {
                                        try {
                                            var c = b.id.split("_")
                                                , d = x(c[1])
                                                , e = f[d].input_list[c[2]];
                                            a.classList.contains("active") && "On" == e.Phantom_power ? (a.classList.remove("active"),
                                                e.Phantom_power = "Off") : (a.classList.add("active"),
                                                e.Phantom_power = "On")
                                        } catch (Jc) {
                                            console.log("\u041e\u0428\u0418\u0411\u041a\u0410 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 phantom_power_click"),
                                                console.log(Jc)
                                        }
                                    }
                                }(z, c);
                                z.className = "On" == n.Phantom_power ? "phantom active" : "phantom";
                                b.appendChild(z)
                            }
                            b = c.insertCell();
                            if (n.Locked)
                                b.innerHTML = '<img src="../interface/lock.png" />';
                            else {
                                if (1 < n.Channel) {
                                    var w = document.createElement("div");
                                    w.title = "Move channel up (decrease number)";
                                    w.className = "arrow-up";
                                    b.appendChild(w);
                                    w.id = "up_" + n.Obj_id + "_" + q + "_" + m;
                                    w.addEventListener("click", function(a) {
                                        Pa(this)
                                    })
                                }
                                g < f.length - 1 && (w = document.createElement("div"),
                                    w.title = "Move channel down (increase number)",
                                    w.className = "arrow-down",
                                    b.appendChild(w),
                                    w.id = "down_" + n.Obj_id + "_" + q + "_" + m,
                                    w.addEventListener("click", function(a) {
                                        Pa(this)
                                    }))
                            }
                            b = c.insertCell();
                            b.innerHTML = n.Source;
                            b.onclick = u(c);
                            b = c.insertCell();
                            b.innerHTML = n.Type;
                            b.onclick = u(c);
                            b = c.insertCell();
                            b.innerHTML = n.ChName;
                            b.onclick = u(c);
                            b = c.insertCell();
                            b.innerHTML = n.Comment;
                            b.onclick = u(c);
                            b = c.insertCell();
                            var v = document.createElement("BUTTON");
                            v.innerHTML = '<img src="../interface/8_1.png" />';
                            v.className = "edit-mode-button";
                            u = function(a) {
                                return function() {
                                    Sb(a.parentElement.parentElement)
                                }
                            }
                            ;
                            v.onclick = u(v);
                            b.appendChild(v);
                            Rb(d)
                        }
                    else
                        Oa(h)
                }
            }
            "input" == a ? (k = I,
                m = "CH",
                l = O) : "output" == a && (k = J,
                m = "MIX",
                l = ha);
            if (k && 0 < k.length)
                for (q = 0; q < k.length; q++)
                    n = k[q],
                    n.Channel || (n.Channel = Na(d, l)),
                        c = d.insertRow(),
                        c.id = "id_Stage_" + q + "_" + m,
                        b = c.insertCell(),
                        b.innerHTML = n.Channel,
                        Ba = "",
                    "input" == a && "On" == n.Phantom_power && (Ba = '<sup class="phantom">+48v</sup>',
                        b.innerHTML += Ba),
                        b = c.insertCell(),
                        n.Locked ? b.innerHTML = '<img src="../interface/lock.png" />' : (0 < q && (w = document.createElement("div"),
                            w.title = "Move channel up (decrease number)",
                            w.className = "arrow-up",
                            b.appendChild(w),
                            w.id = "up_Stage_" + q + "_" + m,
                            w.addEventListener("click", function(a) {
                                Pa(this)
                            })),
                        q < k.length - 1 && (w = document.createElement("div"),
                            w.title = "Move channel down (increase number)",
                            w.className = "arrow-down",
                            b.appendChild(w),
                            w.id = "down_Stage_" + q + "_" + m,
                            w.addEventListener("click", function(a) {
                                Pa(this)
                            }))),
                        b = c.insertCell(),
                        b.innerHTML = n.Source,
                        b = c.insertCell(),
                        b.innerHTML = n.Type,
                        b = c.insertCell(),
                        b.innerHTML = n.ChName,
                        b = c.insertCell(),
                        b.innerHTML = n.Comment,
                        b = c.insertCell(),
                        v = document.createElement("BUTTON"),
                        v.innerHTML = '<img src="../interface/8_1.png" />',
                        v.className = "edit-mode-button",
                        u = function(a) {
                            return function() {
                                Sb(a.parentElement.parentElement)
                            }
                        }
                        ,
                        v.onclick = u(v),
                        b.appendChild(v),
                        Rb(d);
            Hc(d);
            var p = document.getElementById(a + "-list-container");
            document.getElementById(a + "-list-header").innerHTML = a + " List (" + (d.rows.length - 1) + ")";
            p.innerHTML = "";
            v = document.createElement("BUTTON");
            v.innerHTML = '<img src="../interface/8_1.png" />';
            v.className = "edit-mode-button";
            u = function(b) {
                return function() {
                    S(document.getElementById(a + "_list_table"))
                }
            }
            ;
            v.onclick = u(v);
            p.appendChild(v);
            var r = document.createElement("h2");
            r.innerHTML = a + " List (" + (d.rows.length - 1) + ")";
            p.appendChild(r);
            p.appendChild(d)
        } catch (yc) {
            console.log("\u041e\u0428\u0418\u0411\u041a\u0410 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 update_input_list"),
                console.log(yc)
        }
    }
    function Pa(a) {
        try {
            var b = a.id.split("_"), c;
            if ("Stage" == b[1]) {
                "CH" == b[3] ? c = I : "MIX" == b[3] && (c = J);
                var d = parseInt(b[2]);
                "up" == b[0] && 0 < d ? c.splice(d - 1, 2, c[d], c[d - 1]) : "down" == b[0] && d < c.length - 1 && c.splice(d, 2, c[d + 1], c[d])
            } else {
                var e = x(b[1]);
                "CH" == b[3] ? c = f[e].input_list : "MIX" == b[3] && (c = f[e].output_list);
                d = parseInt(b[2]);
                if (0 == d && "up" == b[0] && 0 < e) {
                    var g = e - 1;
                    if ("CH" == b[3] && 0 == f[g].input_list.length)
                        for (d = e - 2; 0 <= d; d--) {
                            if (0 < f[d].input_list.length && !f[d].input_list[f[d].input_list.length - 1].Locked) {
                                g = d;
                                break
                            }
                        }
                    else if ("MIX" == b[3] && 0 == f[g].output_list.length)
                        for (d = e - 2; 0 <= d; d--)
                            if (0 < f[d].output_list.length && !f[d].output_list[f[d].output_list.length - 1].Locked) {
                                g = d;
                                break
                            }
                    var h = f[e];
                    f[e] = f[g];
                    f[g] = h
                } else if (d == c.length - 1 && "down" == b[0] && e < f.length - 1) {
                    g = e + 1;
                    if ("CH" == b[3] && 0 == f[g].input_list.length)
                        for (d = e + 2; d < f[g].length; d++) {
                            if (0 < f[d].input_list.length && !f[d].input_list[0].Locked) {
                                g = d;
                                break
                            }
                        }
                    else if ("MIX" == b[3] && 0 == f[g].output_list.length)
                        for (d = e + 2; d < f[g].length; d++)
                            if (0 < f[d].output_list.length && !f[d].output_list[0].Locked) {
                                g = d;
                                break
                            }
                    h = f[e];
                    f[e] = f[g];
                    f[g] = h
                } else
                    0 < d && "up" == b[0] ? c.splice(d - 1, 2, c[d], c[d - 1]) : d < c.length - 1 && "down" == b[0] && c.splice(d, 2, c[d + 1], c[d])
            }
            X();
            L();
            U();
            "CH" == b[3] ? S(document.getElementById("input_list_table")) : "MIX" == b[3] && S(document.getElementById("output_list_table"))
        } catch (k) {
            console.log("\u041e\u0428\u0418\u0411\u041a\u0410 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 move_input_channel"),
                console.log(k)
        }
    }
    function Sb(a) {
        try {
            var b = a.id.split("_"), c;
            if ("Stage" == b[1])
                "CH" == b[3] ? c = I : "MIX" == b[3] && (c = J);
            else {
                var d = x(b[1]);
                "CH" == b[3] ? c = f[d].input_list : "MIX" == b[3] && (c = f[d].output_list)
            }
            var e = document.getElementById("list_edit_form");
            e.elements.namedItem("ID").value = a.id;
            e.elements.namedItem("Name").value = c[b[2]].ChName;
            e.elements.namedItem("Source").value = c[b[2]].Source;
            e.elements.namedItem("Channel").value = c[b[2]].Channel;
            e.elements.namedItem("Type").value = c[b[2]].Type;
            e.elements.namedItem("Comment").value = c[b[2]].Comment;
            "Locked"in c[b[2]] && c[b[2]].Locked ? e.elements.namedItem("Locked").checked = !0 : e.elements.namedItem("Locked").checked = !1;
            var g = document.getElementById("list-edit-container");
            A(g)
        } catch (h) {
            console.log("\u041e\u0428\u0418\u0411\u041a\u0410 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 open_list_edit_form"),
                console.log(h)
        }
    }
    function Tb(a) {
        try {
            var b = a.id.split("_"), c;
            if ("Stage" == b[1])
                c = K;
            else {
                var d = x(b[1]);
                c = f[d].gear_list
            }
            var e = document.getElementById("gear_list_edit_form");
            e.elements.namedItem("ID").value = a.id;
            e.elements.namedItem("Name").value = c[b[2]].Name;
            e.elements.namedItem("Category").value = c[b[2]].Category;
            e.elements.namedItem("Image").value = c[b[2]].Image;
            e.elements.namedItem("Weight").value = c[b[2]].Weight;
            e.elements.namedItem("Count").value = c[b[2]].Count;
            e.elements.namedItem("Power").value = c[b[2]].Power_consumption;
            e.elements.namedItem("Owner").value = c[b[2]].Owner;
            e.elements.namedItem("Comment").value = c[b[2]].Comment;
            var g = document.getElementById("gear-list-edit-container");
            A(g)
        } catch (h) {
            console.log("\u041e\u0428\u0418\u0411\u041a\u0410 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 open_list_edit_form"),
                console.log(h)
        }
    }
    function U() {
        L("output")
    }
    function Kc(a, b) {
        for (var c = 0; c < a.length; c++)
            if (a[c].Name == b)
                return c;
        return -1
    }
    function ea() {
        try {
            var a, b, c;
            c = document.createElement("table");
            c.id = "gear_list_table";
            c.classList.add("info-table");
            c.classList.add("noedit-mode");
            b = c.insertRow();
            var d = document.createElement("TH");
            d.innerHTML = "\u2116";
            b.appendChild(d);
            d = document.createElement("TH");
            d.innerHTML = "Pic";
            b.appendChild(d);
            d = document.createElement("TH");
            d.innerHTML = "Name";
            b.appendChild(d);
            d = document.createElement("TH");
            d.innerHTML = "Count";
            b.appendChild(d);
            d = document.createElement("TH");
            d.innerHTML = "Weight";
            b.appendChild(d);
            d = document.createElement("TH");
            d.innerHTML = "Power";
            b.appendChild(d);
            d = document.createElement("TH");
            d.innerHTML = "Owner";
            b.appendChild(d);
            d = document.createElement("TH");
            d.innerHTML = "Comment";
            b.appendChild(d);
            d = document.createElement("TH");
            d.innerHTML = "";
            b.appendChild(d);
            for (var e = 0, d = [], g = 0, h = 0, k = 0; k <= f.length; k++)
                if ((list = k == f.length ? K : f[k].gear_list) && 0 < list.length)
                    for (var m = 0; m < list.length; m++) {
                        e++;
                        var l = list[m];
                        if (l.Category) {
                            var q = Kc(d, l.Category);
                            if (-1 < q) {
                                for (var n = !1, u = 0; u < d[q].gears.length; u++) {
                                    var p = d[q].gears[u];
                                    if (p.Name == l.Name) {
                                        if (p.is_container)
                                            p.children.push(l),
                                                p.Count += l.Count,
                                                p.Weight += l.Weight,
                                                p.Power_consumption += l.Power_consumption;
                                        else {
                                            var z = {};
                                            z.Name = p.Name;
                                            z.obj = p.obj;
                                            z.Count = p.Count + l.Count;
                                            z.Count_round = 1;
                                            z.Weight = p.Weight + l.Weight;
                                            z.Weight_round = .1;
                                            z.Power_consumption = p.Power_consumption + l.Power_consumption;
                                            z.Image = p.Image;
                                            z.Owner = p.Owner;
                                            z.Comment = p.Comment;
                                            z.is_container = !0;
                                            z.children = [p];
                                            z.children.push(l);
                                            d[q].gears[u] = z
                                        }
                                        n = !0
                                    }
                                }
                                n || d[q].gears.push(l)
                            } else {
                                var w = {};
                                w.Name = l.Category;
                                w.gears = [l];
                                w.Index = cb.indexOf(w.Name);
                                d.push(w);
                                Gc(d)
                            }
                            "Rent" == l.Owner && (g += parseFloat(l.Weight));
                            h += l.Power_consumption
                        } else
                            alert("\u041d\u0430\u0434\u0435\u043d\u044c\u043a\u0430 \u0437\u0430\u0431\u044b\u043b\u0430 \u0432\u0432\u0435\u0441\u0442\u0438 \u043a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u044e \u0443 " + l.Name + " " + l.Comment)
                    }
            for (m = p = 0; m < d.length; m++)
                for (w = d[m],
                         b = c.insertRow(),
                         b.id = "id_categry_" + m,
                         b.className = "odd_row",
                         e = function(a) {
                             return function() {
                                 try {
                                     for (var b = parseInt(a.id.split("_")[2]), c = document.getElementById("id_categry_" + (b + 1)), d = document.getElementById("gear_list_table"), b = 1, e = d.rows.length, f = 0; f < d.rows.length; f++)
                                         if (a == d.rows[f] && (b = f + 1),
                                         c == d.rows[f]) {
                                             e = f;
                                             break
                                         }
                                     for (var g = d.rows[b].classList.contains("hidden"), h = 1E3, k = -1, f = b; f < e; f++) {
                                         var l = d.rows[f];
                                         if (l.id.includes("id_gear_"))
                                             var m = parseInt(l.id.split("_")[2])
                                                 , h = f + 1
                                                 , k = f + m;
                                         if (l == c)
                                             break;
                                         !g || f >= h && f <= k ? l.classList.add("hidden") : l.classList.remove("hidden")
                                     }
                                 } catch (Mc) {
                                     console.log("\u041e\u0428\u0418\u0411\u041a\u0410 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 hide_show_gear_category"),
                                         console.log(Mc)
                                 }
                             }
                         }
                         ,
                         b.onclick = e(b),
                         a = b.insertCell(),
                         a.colSpan = 8,
                         a.innerHTML = w.Name,
                         a = b.insertCell(),
                         a.innerHTML = "",
                         k = 0; k < w.gears.length; k++)
                    if (l = w.gears[k],
                        l.is_container)
                        for (b = c.insertRow(),
                                 b.id = "id_gear_" + l.children.length + "_" + l.Obj_id,
                                 b.onclick = function(a) {
                                     return function() {
                                         try {
                                             for (var b = parseInt(a.id.split("_")[2]), c = document.getElementById("gear_list_table"), d = 1, e = 0; e < c.rows.length; e++)
                                                 if (a == c.rows[e]) {
                                                     d = e + 1;
                                                     break
                                                 }
                                             for (var f = c.rows[d].classList.contains("hidden"), e = d; e < d + b; e++) {
                                                 var g = c.rows[e];
                                                 f ? g.classList.remove("hidden") : g.classList.add("hidden")
                                             }
                                         } catch (Lc) {
                                             console.log("\u041e\u0428\u0418\u0411\u041a\u0410 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 hide_show_gear_container"),
                                                 console.log(Lc)
                                         }
                                     }
                                 }(b),
                                 a = b.insertCell(),
                                 a.innerHTML = c.rows.length - m - 2 - p,
                                 a = b.insertCell(),
                                 a.onclick = e(b),
                             l.Image && (a.classList.add("wopadding"),
                                 a.innerHTML = "<img src='../gear_images/" + l.Image + "' width='100px'/>"),
                                 a = b.insertCell(),
                                 a.innerHTML = l.Name,
                                 a = b.insertCell(),
                                 a.innerHTML = Math.ceil(l.Count / l.Count_round) * l.Count_round,
                                 a = b.insertCell(),
                                 a.innerHTML = (Math.ceil(l.Weight / l.Weight_round) * l.Weight_round).toFixed(2),
                                 a = b.insertCell(),
                                 a.innerHTML = "",
                                 a = b.insertCell(),
                                 a.innerHTML = l.Owner,
                                 a = b.insertCell(),
                                 a.title = l.Comment,
                                 a.innerHTML = 20 < l.Comment.length ? l.Comment.substr(0, 20) + "..." : l.Comment,
                                 a = b.insertCell(),
                                 p += l.children.length,
                                 u = 0; u < l.children.length; u++)
                            b = c.insertRow(),
                                q = "Stage" == l.children[u].Obj_id ? K.indexOf(l.children[u]) : f[x(l.children[u].Obj_id)].gear_list.indexOf(l.children[u]),
                                b.id = "id_" + l.children[u].Obj_id + "_" + q + "_" + m + "_" + k,
                            l.children[u].obj == t && null != t && b.classList.add("selected_row"),
                                b.classList.add("input_" + l.children[u].Obj_id),
                                b.classList.add("hidden"),
                                e = function(a) {
                                    return function() {
                                        gb(a)
                                    }
                                }
                                ,
                                a = b.insertCell(),
                                a.innerHTML = "",
                                a.onclick = e(b),
                                a = b.insertCell(),
                                a.onclick = e(b),
                            l.children[u].Image && (a.classList.add("wopadding"),
                                a.innerHTML = "<img src='../gear_images/" + l.children[u].Image + "' width='100px'/>"),
                                a = b.insertCell(),
                                a.onclick = e(b),
                                a.innerHTML = l.children[u].Name,
                                a = b.insertCell(),
                                a.onclick = e(b),
                                a.innerHTML = Math.ceil(l.children[u].Count / l.children[u].Count_round) * l.children[u].Count_round,
                                a = b.insertCell(),
                                a.onclick = e(b),
                                a.innerHTML = (Math.ceil(l.children[u].Weight / l.children[u].Weight_round) * l.children[u].Weight_round).toFixed(2),
                                a = b.insertCell(),
                                a.onclick = e(b),
                                a.innerHTML = l.children[u].Power_consumption,
                                a = b.insertCell(),
                                a.onclick = e(b),
                                a.innerHTML = l.children[u].Owner,
                                a = b.insertCell(),
                                a.onclick = e(b),
                                a.title = l.children[u].Comment,
                                a.innerHTML = 20 < l.Comment.length ? l.children[u].Comment.substr(0, 20) + "..." : l.children[u].Comment,
                                a = b.insertCell(),
                                v = document.createElement("BUTTON"),
                                v.innerHTML = '<img src="../interface/8_1.png" />',
                                v.className = "edit-mode-button",
                                r = function(a) {
                                    return function() {
                                        Tb(a.parentElement.parentElement)
                                    }
                                }
                                ,
                                v.onclick = r(v),
                                a.appendChild(v);
                    else {
                        b = c.insertRow();
                        q = "Stage" == l.Obj_id ? K.indexOf(l) : f[x(l.Obj_id)].gear_list.indexOf(l);
                        b.id = "id_" + l.Obj_id + "_" + q + "_" + m + "_" + k;
                        l.obj == t && null != t && b.classList.add("selected_row");
                        b.classList.add("input_" + l.Obj_id);
                        e = function(a) {
                            return function() {
                                gb(a)
                            }
                        }
                        ;
                        a = b.insertCell();
                        a.innerHTML = c.rows.length - m - 2 - p;
                        a.onclick = e(b);
                        a = b.insertCell();
                        a.onclick = e(b);
                        l.Image && (a.classList.add("wopadding"),
                            a.innerHTML = "<img src='../gear_images/" + l.Image + "'/>");
                        a = b.insertCell();
                        a.onclick = e(b);
                        a.innerHTML = l.Name;
                        a = b.insertCell();
                        a.onclick = e(b);
                        a.innerHTML = Math.ceil(l.Count / l.Count_round) * l.Count_round;
                        a = b.insertCell();
                        a.onclick = e(b);
                        a.innerHTML = (Math.ceil(l.Weight / l.Weight_round) * l.Weight_round).toFixed(2);
                        a = b.insertCell();
                        a.onclick = e(b);
                        a.innerHTML = l.Power_consumption;
                        a = b.insertCell();
                        a.onclick = e(b);
                        a.innerHTML = l.Owner;
                        a = b.insertCell();
                        a.onclick = e(b);
                        a.title = l.Comment;
                        a.innerHTML = 20 < l.Comment.length ? l.Comment.substr(0, 20) + "..." : l.Comment;
                        a = b.insertCell();
                        var v = document.createElement("BUTTON");
                        v.innerHTML = '<img src="../interface/8_1.png" />';
                        v.className = "edit-mode-button";
                        var r = function(a) {
                            return function() {
                                Tb(a.parentElement.parentElement)
                            }
                        };
                        v.onclick = r(v);
                        a.appendChild(v)
                    }
            var y = document.getElementById("gear-list-container")
                , A = document.getElementById("gear-list-header")
                , g = (.1 * Math.ceil(g / .1)).toFixed(1)
                , h = (h / 1E3).toFixed(1);
            c.rows[0].cells[4].innerHTML = "Weight (" + g + ")";
            c.rows[0].cells[5].innerHTML = "Power (" + h + ")";
            var B = document.createElement("h2");
            B.className = "gear-list-header";
            B.innerHTML = "Gear List (" + (c.rows.length - d.length - 1) + " it. w.: " + g + " kg " + h + " kW)";
            A.innerHTML = "Gear List (" + (c.rows.length - d.length - 1) + ")";
            y.innerHTML = "";
            v = document.createElement("BUTTON");
            v.innerHTML = '<img src="../interface/8_1.png" />';
            v.className = "edit-mode-button";
            r = function(a) {
                return function() {
                    S(document.getElementById("gear_list_table"))
                }
            }
            ;
            v.onclick = r(v);
            y.appendChild(v);
            y.appendChild(B);
            (0 < d.length || 0 < K.length) && y.appendChild(c)
        } catch (Ic) {
            console.log("\u041e\u0428\u0418\u0411\u041a\u0410 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 update_gear_list"),
                console.log(Ic)
        }
    }
    function A(a) {
        try {
            a && (a.classList.contains("hidden") ? a.classList.remove("hidden") : a.classList.add("hidden"))
        } catch (b) {
            console.log("\u041e\u0428\u0418\u0411\u041a\u0410 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 hide_show_element"),
                console.log(b)
        }
    }
    function Ub() {
        for (var a = 0; a < f.length; a++)
            document.getElementById("anchor" + f[a].id).style.visibility = T || f[a].obj == t ? "visible" : "hidden"
    }
    function ic(a) {
        oa("show_anchors_button");
        T = T ? !1 : !0;
        Ub()
    }
    function jc(a) {
        oa("show_grid_button");
        na ? sb() : rb()
    }
    function rb() {
        na = !0;
        var a = p.get_object_by_name("Plane");
        p.show_object(a)
    }
    function sb() {
        na = !1;
        var a = p.get_object_by_name("Plane");
        p.hide_object(a)
    }
    function Fc(a) {
        try {
            if (0 <= x(a.render.data_id))
                console.log(f);
            else {
                var b = a.name
                    , c = {};
                c.id = a.render.data_id;
                c.obj = a;
                c.obj = a;
                c.name = b;
                c.Comment = "";
                c.input_list = [];
                c.output_list = [];
                c.gear_list = [];
                c.parent = "";
                c.Title = b;
                c.selected = !1;
                f.push(c);
                M ? Vb(F, "", c) : (alert("\u041e\u0448\u0438\u0431\u043a\u0430! \u041f\u0440\u0435\u0441\u0435\u0442 \u043d\u0435 \u0437\u0430\u0433\u0440\u0443\u0436\u0435\u043d. \u0421\u0447\u0435\u0442\u0447\u0438\u043a \u043e\u0436\u0438\u0434\u0430\u0435\u043c\u044b\u0445 \u043a \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0435 \u043e\u0431\u044c\u0435\u043a\u0442\u043e\u0432: " + R),
                    console.log(F),
                    console.log(f))
            }
        } catch (d) {
            console.log("\u041e\u0428\u0418\u0411\u041a\u0410 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 add_params"),
                console.log(d)
        }
    }
    function Vb(a, b, c) {
        try {
            if (b || (b = ""),
            a.name || alert("Someone forget 'name' in preset of " + a.model_src + " " + a.Title),
            !a.id && a.name == c.name) {
                a.id = c.id;
                c.Title = a.Title;
                c.Comment = a.Comment;
                c.model_src = a.model_src;
                c.X = a.X;
                c.Y = a.Y;
                c.Z = void 0 === a.Z ? a.Z = 0 : a.Z;
                c.Is_Structure = 1 == a.Is_Structure || 1 == a.is_structure;
                c.Height = a.Height;
                void 0 === c.Height && (c.Height = 0);
                c.turn = a.turn;
                c.Locked = a.Locked;
                c.Title_to_Source = 1 == a.Title_to_Source;
                c.children = [];
                for (var d = 0; d < a.input_list.length; d++) {
                    var e = {};
                    e.Source = a.input_list[d].Source;
                    e.Type = a.input_list[d].Type;
                    e.ChName = a.input_list[d].ChName;
                    e.Comment = a.input_list[d].Comment;
                    e.Phantom_power = a.input_list[d].Phantom_power;
                    e.Channel = a.input_list[d].Channel;
                    e.Locked = 1 == a.input_list[d].Locked;
                    e.Obj_id = c.id;
                    e.obj = c.obj;
                    c.input_list.push(e)
                }
                for (d = 0; d < a.output_list.length; d++)
                    e = {},
                        e.Source = a.output_list[d].Source,
                        e.Type = a.output_list[d].Type,
                        e.ChName = a.output_list[d].ChName,
                        e.Comment = a.output_list[d].Comment,
                        e.Channel = a.output_list[d].Channel,
                        e.Locked = 1 == a.output_list[d].Locked,
                        e.Obj_id = c.id,
                        e.obj = c.obj,
                        c.output_list.push(e);
                for (d = 0; d < a.gear_list.length; d++)
                    e = {},
                        e.Name = a.gear_list[d].Name,
                        e.Category = a.gear_list[d].Category,
                        e.Image = a.gear_list[d].Image,
                        e.Comment = a.gear_list[d].Comment,
                        e.Weight = a.gear_list[d].Weight,
                        e.Power_consumption = a.gear_list[d].Power_consumption ? parseInt(a.gear_list[d].Power_consumption) : 0,
                        e.Weight_round = a.gear_list[d].Weight_round ? a.gear_list[d].Weight_round : .1,
                        e.Count_round = a.gear_list[d].Count_round ? a.gear_list[d].Count_round : 1,
                        e.Count = a.gear_list[d].Count,
                        e.Owner = a.gear_list[d].Owner,
                        e.Obj_id = c.id,
                        e.obj = c.obj,
                        c.gear_list.push(e);
                c.parent = b;
                R--;
                if (0 >= R) {
                    Ga = M = !1;
                    Wb();
                    console.log("_last_index:" + ba);
                    Ia();
                    console.log(F);
                    a = ba;
                    try {
                        a || (a = 0);
                        for (c = a; c < f.length; c++)
                            if (!f[c].parent && !Ga && 0 != ra && 0 != qa) {
                                var g = ra - f[c].X
                                    , h = qa - f[c].Y;
                                f[c].X = ra;
                                f[c].Y = qa;
                                hb(f[c], g, h);
                                qa = ra = 0;
                                Ca = "";
                                break
                            }
                        for (c = a; c < f.length; c++) {
                            var k = new Float32Array(3);
                            f[c].parent || Ga || Xb(f[c]);
                            k[0] = f[c].X;
                            k[1] = f[c].Y;
                            k[2] = f[c].Z;
                            var m = D.get_parent(f[c].obj);
                            m && D.is_armature(m) ? y.set_translation_v(m, k) : y.set_translation_v(f[c].obj, k);
                            0 != f[c].turn && Hb(f[c].obj, f[c].turn * Math.PI / 180)
                        }
                    } catch (fa) {
                        console.log("\u041e\u0428\u0418\u0411\u041a\u0410 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 set_objects_to_positions"),
                            console.log(fa)
                    }
                    g = ba;
                    try {
                        if (0 > g || g > f.length - 1)
                            g = 0;
                        var l, q, n, p, t;
                        for (l = !0; l; ) {
                            l = !1;
                            for (q = g; q < f.length - 1; q++) {
                                t = !1;
                                var r = f[q].input_list;
                                n = 0 < r.length && r[0].Channel ? parseInt(r[0].Channel) : 0;
                                r = f[q + 1].input_list;
                                p = 0 < r.length && r[0].Channel ? parseInt(r[0].Channel) : 0;
                                if (n > p) {
                                    t = !0;
                                    break
                                }
                            }
                            if (t) {
                                var w = f[q];
                                f[q] = f[q + 1];
                                f[q + 1] = w;
                                l = !0
                            }
                        }
                    } catch (fa) {
                        console.log("\u041e\u0428\u0418\u0411\u041a\u0410 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 sort_objects_by_channel"),
                            console.log(fa)
                    }
                    X();
                    ba = f.length;
                    F = null;
                    Ma();
                    try {
                        for (l = 0; l <= f.length; l++) {
                            var v, x;
                            l == f.length ? (v = I,
                                x = J) : (v = f[l].input_list,
                                x = f[l].output_list);
                            for (q = 0; q < v.length; q++)
                                v[q].Locked = !1;
                            for (q = 0; q < x.length; q++)
                                x[q].Locked = !1
                        }
                        O = [];
                        ha = []
                    } catch (fa) {
                        console.log("\u041e\u0428\u0418\u0411\u041a\u0410 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 unlock_channels"),
                            console.log(fa)
                    }
                    L();
                    U();
                    ea()
                }
            } else if (a.children && 0 < a.children.length)
                for (d = 0; d < a.children.length && (v = R,
                    Vb(a.children[d], a.id, c),
                v == R); d++)
                    ;
        } catch (fa) {
            console.log("\u041e\u0428\u0418\u0411\u041a\u0410 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 update_params_from_preset"),
                console.log(fa)
        }
    }
    function Wb(a) {
        try {
            if (a || (a = F),
            a.children && 0 < a.children.length)
                for (var b = 0; b < a.children.length; b++) {
                    var c = x(a.children[b].id);
                    f[c].parent != a.id && (f[c].parent = a.id);
                    Wb(a.children[b])
                }
        } catch (d) {
            console.log("\u041e\u0428\u0418\u0411\u041a\u0410 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 check_parent_relations"),
                console.log(d)
        }
    }
    function Lb(a) {
        try {
            if (0 < a.children.length)
                for (var b = 0; b < a.children.length; b++)
                    a.children[b].Xabs = a.children[b].X,
                        a.children[b].Yabs = a.children[b].Y,
                        a.children[b].Zabs = a.children[b].Z,
                        Lb(a.children[b]),
                        a.children[b].X -= a.X,
                        a.children[b].Y -= a.Y,
                        a.children[b].Z -= a.Z
        } catch (c) {
            console.log("\u041e\u0428\u0418\u0411\u041a\u0410 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 set_positions_relative"),
                console.log(c)
        }
    }
    function Mb(a) {
        try {
            if (0 < a.children.length)
                for (var b = 0; b < a.children.length && void 0 !== a.children[b].Xabs; b++)
                    a.children[b].X = a.children[b].Xabs,
                        a.children[b].Y = a.children[b].Yabs,
                        a.children[b].Z = a.children[b].Zabs,
                        delete a.children[b].Xabs,
                        delete a.children[b].Yabs,
                        delete a.children[b].Zabs,
                        Mb(a.children[b])
        } catch (c) {
            console.log("\u041e\u0428\u0418\u0411\u041a\u0410 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 set_positions_absolute"),
                console.log(c)
        }
    }
    function Xb(a) {
        try {
            for (var b, c, d = 0; d < f.length; d++)
                if (c = y.get_translation(f[d].obj, ca),
                    b = y.get_translation(a.obj, ib),
                f[d].id != a.id && f[d].name == a.name && c[0] == a.X + b[0] && c[1] == a.Y + b[1]) {
                    var e = Math.random()
                        , g = a.X
                        , h = a.Y;
                    a.X = ia + (wa - ia) * e;
                    e = Math.random();
                    a.Y = ja + (xa - ja) * e;
                    console.log("rand:" + e + "; obj.X:" + a.X + "; obj.Y:" + a.Y);
                    a.X > wa ? a.X -= a.X - wa : a.X < ia && (a.X += ia - a.X);
                    a.Y > xa ? a.Y -= a.Y - xa : a.Y < ja && (a.Y += ja - a.Y);
                    hb(a, a.X - g, a.Y - h);
                    Xb(a)
                }
        } catch (k) {
            console.log("\u041e\u0428\u0418\u0411\u041a\u0410 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 run"),
                console.log(k)
        }
    }
    function hb(a, b, c) {
        try {
            if (0 < a.children.length)
                for (var d = 0; d < a.children.length; d++)
                    a.children[d].X += b,
                        a.children[d].Y += c,
                        hb(a.children[d], b, c)
        } catch (e) {
            console.log("\u041e\u0428\u0418\u0411\u041a\u0410 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 children_change_pos"),
                console.log(e)
        }
    }
    function Dc(a) {
        return a[1]
    }
    function Ec(a, b, c) {
        try {
            if (1 == c)
                if (ga.get_sensor_value(a, b, 0)) {
                    var d = ga.get_sensor_payload(a, b, 0).coll_obj.render.data_id
                        , e = x(d)
                        , g = x(a.render.data_id);
                    if (0 <= g && 0 <= e)
                        if (f[e].Is_Structure) {
                            if (f[g].Z = f[e].Z + f[e].Height,
                                f[g].is_jump = !0,
                            0 < f[g].children.length)
                                for (var h = 0; h < f.length; h++)
                                    f[h].selected && f[h].id != d && (f[h].Z = f[g].Z + f[g].Height,
                                        f[h].is_jump = !0)
                        } else if (!f[g].Is_Structure && (f[g].Z = 0,
                            f[g].is_jump = !1,
                        0 < f[g].children.length))
                            for (h = 0; h < f.length; h++)
                                f[h].selected && f[h].id != d && (f[h].Z = 0,
                                    f[h].is_jump = !1)
                } else if (g = x(a.render.data_id),
                0 <= g) {
                    f[g].Z = 0;
                    f[g].is_jump = !1;
                    if (0 < f[g].children.length)
                        for (h = 0; h < f.length; h++)
                            f[h].selected && f[h].id != d && (f[h].Z = 0,
                                f[h].is_jump = !1);
                    p.set_outline_color(Nc)
                }
        } catch (k) {
            console.log("\u041e\u0428\u0418\u0411\u041a\u0410 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 trigger_outline"),
                console.log(k)
        }
    }
    function Hb(a, b) {
        try {
            parseInt(b / Math.PI * 180);
            var c = D.get_parent(a);
            if (c && D.is_armature(c)) {
                var d = y.get_rotation(c, Yb);
                Zb.rotateZ(d, b, d);
                y.set_rotation_v(c, d)
            } else
                d = y.get_rotation(a, Yb),
                    Zb.rotateZ(d, b, d),
                    y.set_rotation_v(a, d);
            Qa(a)
        } catch (e) {
            console.log("\u041e\u0428\u0418\u0411\u041a\u0410 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 rotate_object"),
                console.log(e)
        }
    }
    function gb(a) {
        try {
            var b = a.classList[0].substr(6)
                , c = x(b);
            0 <= c && Z(f[c].obj)
        } catch (d) {
            console.log("\u041e\u0428\u0418\u0411\u041a\u0410 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 select_obj_row"),
                console.log(d)
        }
    }
    function Qb(a, b) {
        try {
            var c = x(a.render.data_id);
            if (t == a && f[c].parent != b) {
                for (var d = !1, e = 0; e < f.length; e++)
                    if (f[e].selected && f[e].id == b) {
                        d = !0;
                        break
                    }
                d ? alert("You can select parent only outside this preset") : (f[c].parent = b,
                    Ia())
            }
        } catch (g) {
            console.log("\u041e\u0428\u0418\u0411\u041a\u0410 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 change_parent"),
                console.log(g)
        }
    }
    function Z(a) {
        try {
            if (t != a)
                if (t && (p.clear_outline_anim(t),
                    Ub()),
                a && p.apply_outline_anim(a, 1, 1, 0),
                (t = a) && !P) {
                    var b = t.name
                        , c = t.render.data_id
                        , d = x(c)
                        , e = document.getElementById("properties_form");
                    e.elements.namedItem("ID").value = c;
                    e.elements.namedItem("Name").value = b;
                    e.elements.namedItem("Title").value = f[d].Title;
                    e.elements.namedItem("Comment").value = f[d].Comment;
                    e.elements.namedItem("X").value = f[d].X.toFixed(1);
                    e.elements.namedItem("Y").value = f[d].Y.toFixed(1);
                    e.elements.namedItem("turn").value = f[d].turn;
                    e.elements.namedItem("titletosource").checked = f[d].Title_to_Source;
                    e.elements.namedItem("lock").checked = f[d].Locked;
                    e.elements.namedItem("lockall").checked = !1;
                    document.getElementById("savepreset_form").elements.namedItem("name").value = b;
                    $b(c);
                    var g, h;
                    if (g = document.getElementById("input_list_table"))
                        h = g.rows,
                            jb(h, c);
                    if (g = document.getElementById("output_list_table"))
                        h = g.rows,
                            jb(h, c);
                    if (g = document.getElementById("gear_list_table"))
                        h = g.rows,
                            jb(h, c);
                    ac();
                    f[d].selected = !0;
                    bc();
                    Oa(f[d]);
                    document.getElementById("anchor" + c).style.visibility = "visible";
                    Wa && (Qb(t, Ha.render.data_id),
                        Wa = !1,
                        Ma(),
                        oa("attach"),
                        cont = document.getElementById("waiticon"),
                        A(cont),
                        Z(Ha),
                        Ha = !1)
                } else {
                    e = document.getElementById("properties_form");
                    e.elements.namedItem("ID").value = "";
                    e.elements.namedItem("Name").value = "";
                    e.elements.namedItem("Title").value = "";
                    e.elements.namedItem("Comment").value = "";
                    e.elements.namedItem("X").value = "";
                    e.elements.namedItem("Y").value = "";
                    e.elements.namedItem("turn").value = "";
                    e.elements.namedItem("titletosource").checked = !1;
                    e.elements.namedItem("lock").checked = !1;
                    e.elements.namedItem("lockall").checked = !1;
                    document.getElementById("properties-form-container");
                    $b();
                    var k = document.getElementById("input_list_table");
                    k && kb(k.rows);
                    var m = document.getElementById("output_list_table");
                    m && kb(m.rows);
                    var l = document.getElementById("gear_list_table");
                    l && kb(l.rows);
                    ac()
                }
        } catch (q) {
            console.log("\u041e\u0428\u0418\u0411\u041a\u0410 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 select_obj"),
                console.log(q)
        }
    }
    function oa(a) {
        try {
            var b = document.getElementById(a);
            b.classList.contains("selectable") && (b.classList.contains("selected") ? b.classList.remove("selected") : b.classList.add("selected"))
        } catch (c) {
            console.log("\u041e\u0428\u0418\u0411\u041a\u0410 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 change_button_state"),
                console.log(c)
        }
    }
    function $b(a) {
        try {
            var b = document.getElementById("properties_form").elements.namedItem("Parent"), c, d;
            d = a ? f[x(a)].parent : "";
            for (var e = b.options.length - 1; 0 <= e; e--)
                b.remove(e);
            if (a) {
                c = new Option("Orphan (no Parent)","",!1,!1);
                b.add(c);
                for (e = 0; e < f.length; e++)
                    f[e].id != a && (c = f[e].id == d ? new Option(f[e].Title,f[e].id,!0,!0) : new Option(f[e].Title,f[e].id,!1,!1),
                        b.add(c));
                d || (b.selectedIndex = -1)
            }
        } catch (g) {
            console.log("\u041e\u0428\u0418\u0411\u041a\u0410 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 change_parent_select"),
                console.log(g)
        }
    }
    function Xa() {
        try {
            console.log('===== POST =====', document.getElementById("restore_form"))
            // for (var a = document.getElementById("restore_form").elements.namedItem("rider"), b, c = a.options.length - 1; 0 <= c; c--)
            //     a.remove(c);
            // var d = new XMLHttpRequest;
            // d.open("POST", "../rider.html", !1);
            // d.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
            // d.send(_CSRF + "=" + _CSRFToken + "&action=getriders");
            // var e = JSON.parse(d.responseText);
            // if ("OK" == e.status && e.riders && 0 < e.riders.length)
            //     for (c = 0; c < e.riders.length; c++)
            //         b = new Option(e.riders[c].name + "; updated: " + e.riders[c].change_date,e.riders[c].id,!1,!1),
            //             a.add(b);
            // else
            //     console.log("\u041e\u0428\u0418\u0411\u041a\u0410 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 restore_rider_select: "),
            //         console.log(d);
            // console.log(e)
        } catch (g) {
            // console.log("\u041e\u0428\u0418\u0411\u041a\u0410 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 restore_rider_select"),
            //     console.log(g)
        }
    }
    function Cb() {
        try {
            for (var a = document.getElementById("savepreset_form").elements.namedItem("id"), b, c = a.options.length - 1; 0 < c; c--)
                a.remove(c);
            var d = new XMLHttpRequest;
            d.open("POST", "../preset.php", !1);
            d.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
            d.send(_CSRF + "=" + _CSRFToken + "&action=getall");
            var e = JSON.parse(d.responseText);
            if ("OK" == e.status && e.presets && 0 < e.presets.length)
                for (B = e.presets,
                         c = 0; c < e.presets.length; c++)
                    _currentUser_id == e.presets[c].user_id && (b = new Option(e.presets[c].name,e.presets[c].id,!1,!1),
                        a.add(b));
            else
                console.log("\u041e\u0428\u0418\u0411\u041a\u0410 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 savepreset_as_select_update: "),
                    console.log(d);
            console.log(e)
        } catch (g) {
            console.log("\u041e\u0428\u0418\u0411\u041a\u0410 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 savepreset_as_select_update"),
                console.log(g)
        }
    }
    function vc() {
        try {
            for (var a = document.getElementById("savepreset_form").elements.namedItem("categories[]"), b, c = a.options.length - 1; 0 <= c; c--)
                a.remove(c);
            var d = new XMLHttpRequest;
            d.open("POST", "../preset.php", !1);
            d.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
            d.send(_CSRF + "=" + _CSRFToken + "&action=getcategories");
            var e = JSON.parse(d.responseText);
            if ("OK" == e.status && e.categories && 0 < e.categories.length)
                for (r = e.categories,
                         c = 0; c < r.length; c++)
                    for (b = new Option(r[c].name,r[c].name,!1,!1),
                         c == r.length - 1 && (b.selected = !0),
                             a.add(b),
                             r[c].presets = [],
                             r[c].tags = [],
                             d = 0; d < B.length; d++) {
                        if (B[d].categories.includes(r[c].name)) {
                            r[c].presets.push(B[d]);
                            for (var f = B[d].tags.split(","), h = 0; h < f.length; h++)
                                r[c].tags.includes(f[h]) || r[c].tags.push(f[h])
                        }
                    }
            else
                console.log("\u041e\u0428\u0418\u0411\u041a\u0410 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 preset_categories_select_update: "),
                    console.log(d);
            console.log(e)
        } catch (k) {
            console.log("\u041e\u0428\u0418\u0411\u041a\u0410 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 preset_categories_select_update"),
                console.log(k)
        }
    }
    function wc() {
        try {
            for (var a = document.getElementById("savepreset_form").elements.namedItem("tags[]"), b, c, d; a.firstChild; )
                a.removeChild(a.firstChild);
            var e = new XMLHttpRequest;
            e.open("POST", "../preset.php", !1);
            e.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
            e.send(_CSRF + "=" + _CSRFToken + "&action=gettags");
            var f = JSON.parse(e.responseText);
            if ("OK" == f.status && f.tags && 0 < f.tags.length) {
                G = f.tags;
                for (e = 1; e < f.tags.length; e++)
                    b = new Option(f.tags[e].name,f.tags[e].name,!1,!1),
                    d != f.tags[e]["class"] && (d = f.tags[e]["class"],
                        c = document.createElement("OPTGROUP"),
                        a.add(c)),
                        c.appendChild(b);
                for (e = 1; e < r.length; e++)
                    0 < r[e].presets.length && (r[e].selected_tags = [G[0]])
            } else
                console.log("\u041e\u0428\u0418\u0411\u041a\u0410 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 preset_categories_select_update: "),
                    console.log(e),
                    console.log(f)
        } catch (h) {
            console.log("\u041e\u0428\u0418\u0411\u041a\u0410 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 preset_tags_select_update"),
                console.log(h)
        }
    }
    function Bb() {
        try {
            for (var a = document.getElementById("addobject_form").elements.namedItem("object"), b, c = a.options.length - 1; 0 < c; c--)
                a.remove(c);
            var d = new XMLHttpRequest;
            d.open("POST", "../model.php", !1);
            d.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
            d.send(_CSRF + "=" + _CSRFToken + "&action=getmodels");
            var e = JSON.parse(d.responseText);
            if ("OK" == e.status && e.models && 0 < e.models.length)
                for (c = 0; c < e.models.length; c++)
                    b = new Option(e.models[c].name,e.models[c].image,!1,!1),
                        a.add(b);
            else
                console.log("\u041e\u0428\u0418\u0411\u041a\u0410 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 restore_objects_select: "),
                    console.log(d);
            console.log(e)
        } catch (g) {
            console.log("\u041e\u0428\u0418\u0411\u041a\u0410 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 restore_objects_select"),
                console.log(g)
        }
    }
    function jb(a, b) {
        for (var c = 0, d; d = a[c]; c++)
            d.classList.contains("input_" + b) ? d.classList.contains("selected_row") || d.classList.add("selected_row") : d.classList.contains("selected_row") && d.classList.remove("selected_row")
    }
    function kb(a) {
        for (var b = 0, c; c = a[b]; b++)
            c.classList.contains("selected_row") && c.classList.remove("selected_row")
    }
    function za(a) {
        try {
            Ra = !0;
            a.preventDefault && a.preventDefault();
            var b = H.get_coords_x(a)
                , c = H.get_coords_y(a)
                , d = p.pick_object(b, c);
            Z(d);
            if (t) {
                var e = p.get_active_camera()
                    , f = D.get_parent(t);
                f && D.is_armature(f) ? y.get_translation(f, ca) : y.get_translation(t, ca);
                lb.project_point(e, ca, V);
                V[0] = b - V[0];
                V[1] = c - V[1]
            }
        } catch (h) {
            console.log("\u041e\u0428\u0418\u0411\u041a\u0410 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 main_canvas_down"),
                console.log(h)
        }
    }
    function Db(a) {
        try {
            P = Ra = !0;
            a.preventDefault && a.preventDefault();
            H.get_coords_x(a);
            H.get_coords_y(a);
            var b = p.get_object_by_name("TargetPlane");
            p.show_object(b);
            Z(b)
        } catch (c) {
            console.log("\u041e\u0428\u0418\u0411\u041a\u0410 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 menu_down"),
                console.log(c)
        }
    }
    function ka(a) {
        try {
            console.log("main_canvas_up");
            Ra = !1;
            if (P) {
                Z(null);
                P = !1;
                var b = p.get_object_by_name("TargetPlane");
                p.hide_object(b);
                document.getElementById("waiticon").innerHTML = "";
                if (Y) {
                    var c = document.getElementById("preset_button_" + Y + "");
                    pa();
                    Ya(Y);
                    console.log(c);
                    console.log("preset_button_" + Y + "");
                    c.classList.remove("pushed")
                }
            }
            ya || (ma.enable_camera_controls(!1, !0),
                ya = !0)
        } catch (d) {
            console.log("\u041e\u0428\u0418\u0411\u041a\u0410 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 main_canvas_up"),
                console.log(d)
        }
    }
    function la(a) {
        try {
            if (Ra)
                if (t && P) {
                    ya && (ma.disable_camera_controls(),
                        ya = !1);
                    var b = document.getElementById("waiticon");
                    b.style.left = "" + H.get_coords_x(a) + "px";
                    b.style.top = "" + H.get_coords_y(a) + "px";
                    var c = p.get_active_camera()
                        , d = H.get_coords_x(a)
                        , e = H.get_coords_y(a);
                    if (0 <= d && 0 <= e) {
                        var d = d - V[0]
                            , e = e - V[1]
                            , g = lb.calc_ray(c, d, e, da)
                            , h = W.get_pline_directional_vec(g, ca)
                            , k = y.get_translation(c, ib);
                        W.set_pline_initial_point(da, k);
                        W.set_pline_directional_vec(da, h);
                        var m = W.line_plane_intersect(cc, 0, da, dc);
                        m && 0 > h[2] && (y.set_translation_v(t, m),
                            Qa(t),
                            ra = m[0],
                            qa = m[1])
                    }
                } else if (t && !P && !f[x(t.render.data_id)].Locked && (ya && (ma.disable_camera_controls(),
                    ya = !1),
                    c = p.get_active_camera(),
                    d = H.get_coords_x(a),
                    e = H.get_coords_y(a),
                0 <= d && 0 <= e)) {
                    d -= V[0];
                    e -= V[1];
                    g = lb.calc_ray(c, d, e, da);
                    h = W.get_pline_directional_vec(g, ca);
                    k = y.get_translation(c, ib);
                    W.set_pline_initial_point(da, k);
                    W.set_pline_directional_vec(da, h);
                    if ((m = W.line_plane_intersect(cc, 0, da, dc)) && 0 > h[2]) {
                        var l = D.get_parent(t)
                            , q = t.render.data_id
                            , n = x(q);
                        a = t;
                        l && D.is_armature(l) && (a = l);
                        var u = m[0] - f[n].X
                            , r = m[1] - f[n].Y;
                        f[n].X = m[0];
                        f[n].Y = m[1];
                        f[n].is_jump && (m[2] = f[n].Z);
                        f[n].Z = m[2];
                        y.set_translation_v(a, m);
                        Qa(a);
                        if (!event.shiftKey)
                            for (n = 0; n < f.length; n++)
                                if (f[n].selected && f[n].id != q) {
                                    var z = new Float32Array(3);
                                    z[0] = f[n].X + u;
                                    z[1] = f[n].Y + r;
                                    m[2] = f[n].is_jump ? f[n].Z : 0;
                                    z[2] = f[n].Z;
                                    (l = D.get_parent(f[n].obj)) && D.is_armature(l) ? y.set_translation_v(l, z) : y.set_translation_v(f[n].obj, z);
                                    f[n].X = z[0];
                                    f[n].Y = z[1];
                                    f[n].Z = z[2];
                                    Qa(f[n].obj)
                                }
                    }
                    var w = document.getElementById("properties_form");
                    w.elements.namedItem("X").value = m[0].toFixed(1);
                    w.elements.namedItem("Y").value = m[1].toFixed(1)
                }
        } catch (v) {
            console.log("\u041e\u0428\u0418\u0411\u041a\u0410 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 main_canvas_move"),
                console.log(v)
        }
    }
    function bc() {
        try {
            for (var a = 0, b = 0; b < f.length; b++)
                if (f[b].parent && !f[b].selected && f[x(f[b].parent)].selected) {
                    f[b].selected = !0;
                    p.apply_outline_anim(f[b].obj, 1, 1, 3);
                    var c = Date.now();
                    ec(f[b].id, c, 3);
                    a++
                }
            0 < a && bc()
        } catch (d) {
            console.log("\u041e\u0428\u0418\u0411\u041a\u0410 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 select_group"),
                console.log(d)
        }
    }
    function ec(a, b, c) {
        try {
            var d = Date.now()
                , e = document.getElementById("anchor" + a);
            b + 1E3 * c > d ? (e.style.visibility = "visible",
                setTimeout(ec, 1E3, a, b, c)) : e.style.visibility = "hidden"
        } catch (g) {
            console.log("\u041e\u0428\u0418\u0411\u041a\u0410 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 show_anchor_temp"),
                console.log(g)
        }
    }
    function ac() {
        for (var a = 0; a < f.length; a++)
            f[a].selected = !1
    }
    function Qa(a) {
        try {
            if (eb) {
                y.get_object_bounding_box(a);
                var b = D.get_parent(a)
                    , c = b && D.is_armature(b) ? y.get_translation(b, ca) : y.get_translation(a, ca);
                c[0] > wa ? c[0] -= c[0] - wa : c[0] < ia && (c[0] += ia - c[0]);
                c[1] > xa ? c[1] -= c[1] - xa : c[1] < ja && (c[1] += ja - c[1]);
                if (a) {
                    var d = x(a.render.data_id);
                    0 <= d && (f[d].X = c[0],
                        f[d].Y = c[1])
                }
                b && D.is_armature(b) ? y.set_translation_v(b, c) : y.set_translation_v(a, c)
            }
        } catch (e) {
            console.log("\u041e\u0428\u0418\u0411\u041a\u0410 \u0444\u0443\u043d\u043a\u0446\u0438\u0438 limit_object_position"),
                console.log(e)
        }
    }
    var ma = C("app")
        , Oc = C("config")
        , Aa = C("data")
        , nb = C("preloader")
        , Pc = C("version")
        , lb = C("camera")
        , Sa = C("container")
        , ga = C("controls")
        , H = C("mouse")
        , W = C("math")
        , D = C("objects")
        , Ob = C("physics")
        , p = C("scenes")
        , y = C("transform")
        , Zb = C("quat")
        , Gb = C("anchors");
    C("screen");
    var mb = "DEBUG" == Pc.type()
        , Nc = [0, 1, 0]
        , cc = [0, 0, 1]
        , Ib = Math.PI / 4
        , wa = 5
        , ia = -5
        , xa = 10
        , ja = -10
        , eb = !0
        , Ta = Oc.get_assets_path("my_project")
        , V = new Float32Array(2)
        , Ua = new Float32Array(3)
        , ca = new Float32Array(3)
        , ib = new Float32Array(3)
        , dc = new Float32Array(3)
        , Yb = new Float32Array(4)
        , da = W.create_pline()
        , Ra = !1
        , P = !1
        , ra = 0
        , qa = 0
        , Ca = ""
        , Y = ""
        , ya = !0
        , N = 0
        , t = null
        , f = []
        , M = !1
        , R = 0
        , F = null
        , ba = 0
        , sa = !1
        , ta = !1
        , na = !1
        , T = !1
        , ua = !1
        , va = !1
        , Ga = !1
        , O = []
        , ha = []
        , I = []
        , aa = ""
        , La = ""
        , Q = ""
        , db = 20
        , J = []
        , K = []
        , cb = []
        , B = []
        , r = []
        , G = []
        , Ka = -1
        , Wa = !1
        , Ha = !1
        , Ea = !1
        , Nb = !1
        , Za = 1
        , $a = 1
        , ab = 0
        , bb = 0
        , Eb = !1;
    fc.init = function() {
        var a = mb
            , b = ma.get_url_params();
        b && "show_fps"in b && (a = !0);
        ma.init({
            canvas_container_id: "main_canvas_container",
            callback: gc,
            physics_enabled: !0,
            show_fps: a,
            alpha: !1,
            assets_dds_available: !1,
            assets_min50_available: !mb,
            console_verbose: mb,
            background_color: [1, 1, 1, 0]
        })
    }
    ;
    _request = null
});
b4w.require("my_project_main").init();
